{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "637044e5",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "\n",
       "<style>\n",
       "div.container{width:90% !important;}\n",
       "div.cell.code_cell.rendered{width:100%;}\n",
       "div.input_prompt{padding:0px;}\n",
       "div.CodeMirror {font-family:Consolas; font-size:12pt;}\n",
       "div.text_cell_render.rendered_html{font-size:12pt;}\n",
       "div.output {font-size:12pt; font-weight:bold;}\n",
       "div.input {font-family:Consolas; font-size:12pt;}\n",
       "div.prompt {min-width:70px;}\n",
       "div#toc-wrapper{padding-top:120px;}\n",
       "div.text_cell_render ul li{font-size:12pt;padding:5px;}\n",
       "table.dataframe{font-size:12px;}\n",
       "</style>\n"
      ],
      "text/plain": [
       "<IPython.core.display.HTML object>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "from IPython.display import display, HTML\n",
    "display(HTML(\"\"\"\n",
    "<style>\n",
    "div.container{width:90% !important;}\n",
    "div.cell.code_cell.rendered{width:100%;}\n",
    "div.input_prompt{padding:0px;}\n",
    "div.CodeMirror {font-family:Consolas; font-size:12pt;}\n",
    "div.text_cell_render.rendered_html{font-size:12pt;}\n",
    "div.output {font-size:12pt; font-weight:bold;}\n",
    "div.input {font-family:Consolas; font-size:12pt;}\n",
    "div.prompt {min-width:70px;}\n",
    "div#toc-wrapper{padding-top:120px;}\n",
    "div.text_cell_render ul li{font-size:12pt;padding:5px;}\n",
    "table.dataframe{font-size:12px;}\n",
    "</style>\n",
    "\"\"\"))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "54300365",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "LOCKED: tax-index-znww7g1.svc.aped-4627-b74a.pinecone.io tax-index tax\n"
     ]
    }
   ],
   "source": [
    "# ✅ LOCK CELL (이 셀 위로 다른 셀 실행 금지)\n",
    "HOST_TAX = \"tax-index-znww7g1.svc.aped-4627-b74a.pinecone.io\"\n",
    "INDEX_TAX = \"tax-index\"      # ✅ 이 변수명만 사용\n",
    "NAMESPACE_TAX = \"tax\"\n",
    "\n",
    "print(\"LOCKED:\", HOST_TAX, INDEX_TAX, NAMESPACE_TAX)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "ee90245b",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      ".ipynb_checkpoints\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:469:     \"evalue\": \"(404)\\nReason: Not Found\\nHTTP response headers: HTTPHeaderDict({'content-type': 'text/plain; charset=utf-8', 'access-control-allow-origin': '*', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-expose-headers': '*', 'x-pinecone-api-version': '2025-04', 'x-cloud-trace-context': '8c9b5055b9aedb7fa23ec2b90a573dba', 'date': 'Fri, 09 Jan 2026 03:07:13 GMT', 'server': 'Google Frontend', 'Content-Length': '92', 'Via': '1.1 google', 'Alt-Svc': 'h3=\\\":443\\\"; ma=2592000,h3-29=\\\":443\\\"; ma=2592000'})\\nHTTP response body: {\\\"error\\\":{\\\"code\\\":\\\"NOT_FOUND\\\",\\\"message\\\":\\\"Resource tax-index-upstage not found\\\"},\\\"status\\\":404}\\n\",\n",
      ".ipynb_checkpoints\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:489:      \"\\u001b[1;31mNotFoundException\\u001b[0m: (404)\\nReason: Not Found\\nHTTP response headers: HTTPHeaderDict({'content-type': 'text/plain; charset=utf-8', 'access-control-allow-origin': '*', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-expose-headers': '*', 'x-pinecone-api-version': '2025-04', 'x-cloud-trace-context': '8c9b5055b9aedb7fa23ec2b90a573dba', 'date': 'Fri, 09 Jan 2026 03:07:13 GMT', 'server': 'Google Frontend', 'Content-Length': '92', 'Via': '1.1 google', 'Alt-Svc': 'h3=\\\":443\\\"; ma=2592000,h3-29=\\\":443\\\"; ma=2592000'})\\nHTTP response body: {\\\"error\\\":{\\\"code\\\":\\\"NOT_FOUND\\\",\\\"message\\\":\\\"Resource tax-index-upstage not found\\\"},\\\"status\\\":404}\\n\"\n",
      ".ipynb_checkpoints\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:503:    \"index_name = \\\"tax-index-upstage\\\"\\n\",\n",
      ".ipynb_checkpoints\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:786:     \"evalue\": \"(404)\\nReason: Not Found\\nHTTP response headers: HTTPHeaderDict({'content-type': 'text/plain; charset=utf-8', 'access-control-allow-origin': '*', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-expose-headers': '*', 'x-pinecone-api-version': '2025-04', 'x-cloud-trace-context': '208d662a4af4e3f3057cf1c2efdb6ab5', 'date': 'Fri, 09 Jan 2026 03:05:11 GMT', 'server': 'Google Frontend', 'Content-Length': '92', 'Via': '1.1 google', 'Alt-Svc': 'h3=\\\":443\\\"; ma=2592000,h3-29=\\\":443\\\"; ma=2592000'})\\nHTTP response body: {\\\"error\\\":{\\\"code\\\":\\\"NOT_FOUND\\\",\\\"message\\\":\\\"Resource tax-index-upstage not found\\\"},\\\"status\\\":404}\\n\",\n",
      ".ipynb_checkpoints\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:806:      \"\\u001b[1;31mNotFoundException\\u001b[0m: (404)\\nReason: Not Found\\nHTTP response headers: HTTPHeaderDict({'content-type': 'text/plain; charset=utf-8', 'access-control-allow-origin': '*', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-expose-headers': '*', 'x-pinecone-api-version': '2025-04', 'x-cloud-trace-context': '208d662a4af4e3f3057cf1c2efdb6ab5', 'date': 'Fri, 09 Jan 2026 03:05:11 GMT', 'server': 'Google Frontend', 'Content-Length': '92', 'Via': '1.1 google', 'Alt-Svc': 'h3=\\\":443\\\"; ma=2592000,h3-29=\\\":443\\\"; ma=2592000'})\\nHTTP response body: {\\\"error\\\":{\\\"code\\\":\\\"NOT_FOUND\\\",\\\"message\\\":\\\"Resource tax-index-upstage not found\\\"},\\\"status\\\":404}\\n\"\n",
      ".ipynb_checkpoints\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:899:    \"    index_name=\\\"tax-index-upstage\\\"\\n\",\n",
      ".ipynb_checkpoints\\ch9.10_Retrieval ȿ  ó(table)-checkpoint.ipynb:420:    \"index_name = \\\"tax-index-upstage\\\"\\n\",\n",
      "ch9.09_chromapinecone Ȱ RAG(upstage Embedding).ipynb:126:      \"RUN: findstr /s /n /i \\\"tax-index-upstage\\\" *.py *.ipynb\\n\"\n",
      "ch9.09_chromapinecone Ȱ RAG(upstage Embedding).ipynb:136:      \"Cell \\u001b[1;32mIn[6], line 5\\u001b[0m\\n\\u001b[0;32m      3\\u001b[0m cmd \\u001b[38;5;241m=\\u001b[39m \\u001b[38;5;124mr\\u001b[39m\\u001b[38;5;124m'\\u001b[39m\\u001b[38;5;124mfindstr /s /n /i \\u001b[39m\\u001b[38;5;124m\\\"\\u001b[39m\\u001b[38;5;124mtax-index-upstage\\u001b[39m\\u001b[38;5;124m\\\"\\u001b[39m\\u001b[38;5;124m *.py *.ipynb\\u001b[39m\\u001b[38;5;124m'\\u001b[39m\\n\\u001b[0;32m      4\\u001b[0m \\u001b[38;5;28mprint\\u001b[39m(\\u001b[38;5;124m\\\"\\u001b[39m\\u001b[38;5;124mRUN:\\u001b[39m\\u001b[38;5;124m\\\"\\u001b[39m, cmd)\\n\\u001b[1;32m----> 5\\u001b[0m \\u001b[38;5;28mprint\\u001b[39m(\\u001b[43msubprocess\\u001b[49m\\u001b[38;5;241;43m.\\u001b[39;49m\\u001b[43mgetoutput\\u001b[49m\\u001b[43m(\\u001b[49m\\u001b[43mcmd\\u001b[49m\\u001b[43m)\\u001b[49m)\\n\",\n",
      "ch9.09_chromapinecone Ȱ RAG(upstage Embedding).ipynb:149:    \"cmd = r'findstr /s /n /i \\\"tax-index-upstage\\\" *.py *.ipynb'\\n\",\n",
      "ch9.09_chromapinecone Ȱ RAG(upstage Embedding).ipynb:401:     \"evalue\": \"(404)\\nReason: Not Found\\nHTTP response headers: HTTPHeaderDict({'content-type': 'text/plain; charset=utf-8', 'access-control-allow-origin': '*', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-expose-headers': '*', 'x-pinecone-api-version': '2025-04', 'x-cloud-trace-context': '984b6cc04f966335fbc20b8d2889e464', 'date': 'Fri, 09 Jan 2026 03:38:21 GMT', 'server': 'Google Frontend', 'Content-Length': '92', 'Via': '1.1 google', 'Alt-Svc': 'h3=\\\":443\\\"; ma=2592000,h3-29=\\\":443\\\"; ma=2592000'})\\nHTTP response body: {\\\"error\\\":{\\\"code\\\":\\\"NOT_FOUND\\\",\\\"message\\\":\\\"Resource tax-index-upstage not found\\\"},\\\"status\\\":404}\\n\",\n",
      "ch9.09_chromapinecone Ȱ RAG(upstage Embedding).ipynb:421:      \"\\u001b[1;31mNotFoundException\\u001b[0m: (404)\\nReason: Not Found\\nHTTP response headers: HTTPHeaderDict({'content-type': 'text/plain; charset=utf-8', 'access-control-allow-origin': '*', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-expose-headers': '*', 'x-pinecone-api-version': '2025-04', 'x-cloud-trace-context': '984b6cc04f966335fbc20b8d2889e464', 'date': 'Fri, 09 Jan 2026 03:38:21 GMT', 'server': 'Google Frontend', 'Content-Length': '92', 'Via': '1.1 google', 'Alt-Svc': 'h3=\\\":443\\\"; ma=2592000,h3-29=\\\":443\\\"; ma=2592000'})\\nHTTP response body: {\\\"error\\\":{\\\"code\\\":\\\"NOT_FOUND\\\",\\\"message\\\":\\\"Resource tax-index-upstage not found\\\"},\\\"status\\\":404}\\n\"\n",
      "ch9.09_chromapinecone Ȱ RAG(upstage Embedding).ipynb:435:    \"index_name = \\\"tax-index-upstage\\\"\\n\",\n",
      "ch9.09_chromapinecone Ȱ RAG(upstage Embedding).ipynb:679:    \"    index_name=\\\"tax-index-upstage\\\"\\n\",\n",
      "ch9.10_Retrieval ȿ  ó(table).ipynb:246:     \"evalue\": \"(404)\\nReason: Not Found\\nHTTP response headers: HTTPHeaderDict({'content-type': 'text/plain; charset=utf-8', 'access-control-allow-origin': '*', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-expose-headers': '*', 'x-pinecone-api-version': '2025-04', 'x-cloud-trace-context': 'decd87773c66a7d39a168dec412c208c', 'date': 'Fri, 09 Jan 2026 02:05:50 GMT', 'server': 'Google Frontend', 'Content-Length': '92', 'Via': '1.1 google', 'Alt-Svc': 'h3=\\\":443\\\"; ma=2592000,h3-29=\\\":443\\\"; ma=2592000'})\\nHTTP response body: {\\\"error\\\":{\\\"code\\\":\\\"NOT_FOUND\\\",\\\"message\\\":\\\"Resource tax-index-upstage not found\\\"},\\\"status\\\":404}\\n\",\n",
      "ch9.10_Retrieval ȿ  ó(table).ipynb:266:      \"\\u001b[1;31mNotFoundException\\u001b[0m: (404)\\nReason: Not Found\\nHTTP response headers: HTTPHeaderDict({'content-type': 'text/plain; charset=utf-8', 'access-control-allow-origin': '*', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-expose-headers': '*', 'x-pinecone-api-version': '2025-04', 'x-cloud-trace-context': 'decd87773c66a7d39a168dec412c208c', 'date': 'Fri, 09 Jan 2026 02:05:50 GMT', 'server': 'Google Frontend', 'Content-Length': '92', 'Via': '1.1 google', 'Alt-Svc': 'h3=\\\":443\\\"; ma=2592000,h3-29=\\\":443\\\"; ma=2592000'})\\nHTTP response body: {\\\"error\\\":{\\\"code\\\":\\\"NOT_FOUND\\\",\\\"message\\\":\\\"Resource tax-index-upstage not found\\\"},\\\"status\\\":404}\\n\"\n",
      "ch9.10_Retrieval ȿ  ó(table).ipynb:280:    \"index_name = \\\"tax-index-upstage\\\"\\n\",\n",
      "\n",
      "\n"
     ]
    }
   ],
   "source": [
    "import subprocess\n",
    "\n",
    "cmd = r'findstr /s /n /i \"tax-index-upstage\" *.py *.ipynb'\n",
    "p = subprocess.run(cmd, shell=True, capture_output=True, text=True,\n",
    "                   encoding=\"utf-8\", errors=\"ignore\")\n",
    "print(p.stdout)\n",
    "print(p.stderr)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "9ea1b39f",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "SKIP (not found): ch9.09_chromapinecone Ȱ RAG(upstage Embedding).ipynb\n",
      "SKIP (not found): ch9.10_Retrieval ȿ  ó(table).ipynb\n"
     ]
    }
   ],
   "source": [
    "from pathlib import Path\n",
    "\n",
    "targets = [\n",
    "    Path(\"ch9.09_chromapinecone Ȱ RAG(upstage Embedding).ipynb\"),\n",
    "    Path(\"ch9.10_Retrieval ȿ  ó(table).ipynb\"),\n",
    "]\n",
    "\n",
    "old = \"tax-index-upstage\"\n",
    "new = \"tax-index\"\n",
    "\n",
    "for fp in targets:\n",
    "    if not fp.exists():\n",
    "        print(\"SKIP (not found):\", fp)\n",
    "        continue\n",
    "\n",
    "    text = fp.read_text(encoding=\"utf-8\", errors=\"ignore\")\n",
    "    if old not in text:\n",
    "        print(\"NO CHANGE:\", fp)\n",
    "        continue\n",
    "\n",
    "    fp.write_text(text.replace(old, new), encoding=\"utf-8\")\n",
    "    print(\"UPDATED:\", fp)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "0481110d",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\Admin\\anaconda3\\envs\\llm\\lib\\site-packages\\tqdm\\auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html\n",
      "  from .autonotebook import tqdm as notebook_tqdm\n"
     ]
    },
    {
     "ename": "OpenAIError",
     "evalue": "The api_key client option must be set either by passing api_key to the client or by setting the OPENAI_API_KEY environment variable",
     "output_type": "error",
     "traceback": [
      "\u001b[1;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[1;31mOpenAIError\u001b[0m                               Traceback (most recent call last)",
      "Cell \u001b[1;32mIn[2], line 4\u001b[0m\n\u001b[0;32m      1\u001b[0m \u001b[38;5;28;01mfrom\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;21;01mlangchain_openai\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;28;01mimport\u001b[39;00m OpenAIEmbeddings\n\u001b[0;32m      2\u001b[0m \u001b[38;5;28;01mfrom\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;21;01mlangchain_pinecone\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;28;01mimport\u001b[39;00m PineconeVectorStore\n\u001b[1;32m----> 4\u001b[0m emb_openai \u001b[38;5;241m=\u001b[39m \u001b[43mOpenAIEmbeddings\u001b[49m\u001b[43m(\u001b[49m\u001b[43mmodel\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[38;5;124;43mtext-embedding-3-small\u001b[39;49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[43m)\u001b[49m\n\u001b[0;32m      6\u001b[0m vs_tax \u001b[38;5;241m=\u001b[39m PineconeVectorStore(\n\u001b[0;32m      7\u001b[0m     index_name\u001b[38;5;241m=\u001b[39mINDEX_TAX,\n\u001b[0;32m      8\u001b[0m     embedding\u001b[38;5;241m=\u001b[39memb_openai,\n\u001b[0;32m      9\u001b[0m     host\u001b[38;5;241m=\u001b[39mHOST_TAX,\n\u001b[0;32m     10\u001b[0m     namespace\u001b[38;5;241m=\u001b[39mNAMESPACE_TAX,\n\u001b[0;32m     11\u001b[0m )\n\u001b[0;32m     13\u001b[0m docs \u001b[38;5;241m=\u001b[39m vs_tax\u001b[38;5;241m.\u001b[39msimilarity_search(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124m근로소득 과세표준 세율\u001b[39m\u001b[38;5;124m\"\u001b[39m, k\u001b[38;5;241m=\u001b[39m\u001b[38;5;241m4\u001b[39m)\n",
      "    \u001b[1;31m[... skipping hidden 1 frame]\u001b[0m\n",
      "File \u001b[1;32m~\\anaconda3\\envs\\llm\\lib\\site-packages\\langchain_openai\\embeddings\\base.py:406\u001b[0m, in \u001b[0;36mOpenAIEmbeddings.validate_environment\u001b[1;34m(self)\u001b[0m\n\u001b[0;32m    401\u001b[0m         \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mhttp_async_client \u001b[38;5;241m=\u001b[39m httpx\u001b[38;5;241m.\u001b[39mAsyncClient(proxy\u001b[38;5;241m=\u001b[39m\u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mopenai_proxy)\n\u001b[0;32m    402\u001b[0m     async_specific \u001b[38;5;241m=\u001b[39m {\n\u001b[0;32m    403\u001b[0m         \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mhttp_client\u001b[39m\u001b[38;5;124m\"\u001b[39m: \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mhttp_async_client,\n\u001b[0;32m    404\u001b[0m         \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mapi_key\u001b[39m\u001b[38;5;124m\"\u001b[39m: async_api_key_value,\n\u001b[0;32m    405\u001b[0m     }\n\u001b[1;32m--> 406\u001b[0m     \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39masync_client \u001b[38;5;241m=\u001b[39m openai\u001b[38;5;241m.\u001b[39mAsyncOpenAI(\n\u001b[0;32m    407\u001b[0m         \u001b[38;5;241m*\u001b[39m\u001b[38;5;241m*\u001b[39mclient_params,\n\u001b[0;32m    408\u001b[0m         \u001b[38;5;241m*\u001b[39m\u001b[38;5;241m*\u001b[39masync_specific,  \u001b[38;5;66;03m# type: ignore[arg-type]\u001b[39;00m\n\u001b[0;32m    409\u001b[0m     )\u001b[38;5;241m.\u001b[39membeddings\n\u001b[0;32m    410\u001b[0m \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28mself\u001b[39m\n",
      "File \u001b[1;32m~\\anaconda3\\envs\\llm\\lib\\site-packages\\openai\\_client.py:488\u001b[0m, in \u001b[0;36mAsyncOpenAI.__init__\u001b[1;34m(self, api_key, organization, project, webhook_secret, base_url, websocket_base_url, timeout, max_retries, default_headers, default_query, http_client, _strict_response_validation)\u001b[0m\n\u001b[0;32m    486\u001b[0m     api_key \u001b[38;5;241m=\u001b[39m os\u001b[38;5;241m.\u001b[39menviron\u001b[38;5;241m.\u001b[39mget(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mOPENAI_API_KEY\u001b[39m\u001b[38;5;124m\"\u001b[39m)\n\u001b[0;32m    487\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m api_key \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;28;01mNone\u001b[39;00m:\n\u001b[1;32m--> 488\u001b[0m     \u001b[38;5;28;01mraise\u001b[39;00m OpenAIError(\n\u001b[0;32m    489\u001b[0m         \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mThe api_key client option must be set either by passing api_key to the client or by setting the OPENAI_API_KEY environment variable\u001b[39m\u001b[38;5;124m\"\u001b[39m\n\u001b[0;32m    490\u001b[0m     )\n\u001b[0;32m    491\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mcallable\u001b[39m(api_key):\n\u001b[0;32m    492\u001b[0m     \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mapi_key \u001b[38;5;241m=\u001b[39m \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124m\"\u001b[39m\n",
      "\u001b[1;31mOpenAIError\u001b[0m: The api_key client option must be set either by passing api_key to the client or by setting the OPENAI_API_KEY environment variable"
     ]
    }
   ],
   "source": [
    "from langchain_openai import OpenAIEmbeddings\n",
    "from langchain_pinecone import PineconeVectorStore\n",
    "\n",
    "emb_openai = OpenAIEmbeddings(model=\"text-embedding-3-small\")\n",
    "\n",
    "vs_tax = PineconeVectorStore(\n",
    "    index_name=INDEX_TAX,\n",
    "    embedding=emb_openai,\n",
    "    host=HOST_TAX,\n",
    "    namespace=NAMESPACE_TAX,\n",
    ")\n",
    "\n",
    "docs = vs_tax.similarity_search(\"근로소득 과세표준 세율\", k=4)\n",
    "print(\"docs:\", len(docs))\n",
    "print(docs[0].page_content[:200])\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "882e65f6",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "RUN: findstr /s /n /i \"tax-index-upstage\" *.py *.ipynb\n"
     ]
    },
    {
     "ename": "UnicodeDecodeError",
     "evalue": "'cp949' codec can't decode byte 0xe2 in position 3891: illegal multibyte sequence",
     "output_type": "error",
     "traceback": [
      "\u001b[1;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[1;31mUnicodeDecodeError\u001b[0m                        Traceback (most recent call last)",
      "Cell \u001b[1;32mIn[6], line 5\u001b[0m\n\u001b[0;32m      3\u001b[0m cmd \u001b[38;5;241m=\u001b[39m \u001b[38;5;124mr\u001b[39m\u001b[38;5;124m'\u001b[39m\u001b[38;5;124mfindstr /s /n /i \u001b[39m\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mtax-index-upstage\u001b[39m\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124m *.py *.ipynb\u001b[39m\u001b[38;5;124m'\u001b[39m\n\u001b[0;32m      4\u001b[0m \u001b[38;5;28mprint\u001b[39m(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mRUN:\u001b[39m\u001b[38;5;124m\"\u001b[39m, cmd)\n\u001b[1;32m----> 5\u001b[0m \u001b[38;5;28mprint\u001b[39m(\u001b[43msubprocess\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mgetoutput\u001b[49m\u001b[43m(\u001b[49m\u001b[43mcmd\u001b[49m\u001b[43m)\u001b[49m)\n",
      "File \u001b[1;32m~\\anaconda3\\envs\\llm\\lib\\subprocess.py:645\u001b[0m, in \u001b[0;36mgetoutput\u001b[1;34m(cmd)\u001b[0m\n\u001b[0;32m    635\u001b[0m \u001b[38;5;28;01mdef\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;21mgetoutput\u001b[39m(cmd):\n\u001b[0;32m    636\u001b[0m \u001b[38;5;250m    \u001b[39m\u001b[38;5;124;03m\"\"\"Return output (stdout or stderr) of executing cmd in a shell.\u001b[39;00m\n\u001b[0;32m    637\u001b[0m \n\u001b[0;32m    638\u001b[0m \u001b[38;5;124;03m    Like getstatusoutput(), except the exit status is ignored and the return\u001b[39;00m\n\u001b[1;32m   (...)\u001b[0m\n\u001b[0;32m    643\u001b[0m \u001b[38;5;124;03m    '/bin/ls'\u001b[39;00m\n\u001b[0;32m    644\u001b[0m \u001b[38;5;124;03m    \"\"\"\u001b[39;00m\n\u001b[1;32m--> 645\u001b[0m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[43mgetstatusoutput\u001b[49m\u001b[43m(\u001b[49m\u001b[43mcmd\u001b[49m\u001b[43m)\u001b[49m[\u001b[38;5;241m1\u001b[39m]\n",
      "File \u001b[1;32m~\\anaconda3\\envs\\llm\\lib\\subprocess.py:626\u001b[0m, in \u001b[0;36mgetstatusoutput\u001b[1;34m(cmd)\u001b[0m\n\u001b[0;32m    605\u001b[0m \u001b[38;5;250m\u001b[39m\u001b[38;5;124;03m\"\"\"Return (exitcode, output) of executing cmd in a shell.\u001b[39;00m\n\u001b[0;32m    606\u001b[0m \n\u001b[0;32m    607\u001b[0m \u001b[38;5;124;03mExecute the string 'cmd' in a shell with 'check_output' and\u001b[39;00m\n\u001b[1;32m   (...)\u001b[0m\n\u001b[0;32m    623\u001b[0m \u001b[38;5;124;03m(-15, '')\u001b[39;00m\n\u001b[0;32m    624\u001b[0m \u001b[38;5;124;03m\"\"\"\u001b[39;00m\n\u001b[0;32m    625\u001b[0m \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[1;32m--> 626\u001b[0m     data \u001b[38;5;241m=\u001b[39m \u001b[43mcheck_output\u001b[49m\u001b[43m(\u001b[49m\u001b[43mcmd\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mshell\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[38;5;28;43;01mTrue\u001b[39;49;00m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mtext\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[38;5;28;43;01mTrue\u001b[39;49;00m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mstderr\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mSTDOUT\u001b[49m\u001b[43m)\u001b[49m\n\u001b[0;32m    627\u001b[0m     exitcode \u001b[38;5;241m=\u001b[39m \u001b[38;5;241m0\u001b[39m\n\u001b[0;32m    628\u001b[0m \u001b[38;5;28;01mexcept\u001b[39;00m CalledProcessError \u001b[38;5;28;01mas\u001b[39;00m ex:\n",
      "File \u001b[1;32m~\\anaconda3\\envs\\llm\\lib\\subprocess.py:421\u001b[0m, in \u001b[0;36mcheck_output\u001b[1;34m(timeout, *popenargs, **kwargs)\u001b[0m\n\u001b[0;32m    418\u001b[0m         empty \u001b[38;5;241m=\u001b[39m \u001b[38;5;124mb\u001b[39m\u001b[38;5;124m'\u001b[39m\u001b[38;5;124m'\u001b[39m\n\u001b[0;32m    419\u001b[0m     kwargs[\u001b[38;5;124m'\u001b[39m\u001b[38;5;124minput\u001b[39m\u001b[38;5;124m'\u001b[39m] \u001b[38;5;241m=\u001b[39m empty\n\u001b[1;32m--> 421\u001b[0m \u001b[38;5;28;01mreturn\u001b[39;00m run(\u001b[38;5;241m*\u001b[39mpopenargs, stdout\u001b[38;5;241m=\u001b[39mPIPE, timeout\u001b[38;5;241m=\u001b[39mtimeout, check\u001b[38;5;241m=\u001b[39m\u001b[38;5;28;01mTrue\u001b[39;00m,\n\u001b[0;32m    422\u001b[0m            \u001b[38;5;241m*\u001b[39m\u001b[38;5;241m*\u001b[39mkwargs)\u001b[38;5;241m.\u001b[39mstdout\n",
      "File \u001b[1;32m~\\anaconda3\\envs\\llm\\lib\\subprocess.py:505\u001b[0m, in \u001b[0;36mrun\u001b[1;34m(input, capture_output, timeout, check, *popenargs, **kwargs)\u001b[0m\n\u001b[0;32m    503\u001b[0m \u001b[38;5;28;01mwith\u001b[39;00m Popen(\u001b[38;5;241m*\u001b[39mpopenargs, \u001b[38;5;241m*\u001b[39m\u001b[38;5;241m*\u001b[39mkwargs) \u001b[38;5;28;01mas\u001b[39;00m process:\n\u001b[0;32m    504\u001b[0m     \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[1;32m--> 505\u001b[0m         stdout, stderr \u001b[38;5;241m=\u001b[39m \u001b[43mprocess\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mcommunicate\u001b[49m\u001b[43m(\u001b[49m\u001b[38;5;28;43minput\u001b[39;49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mtimeout\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mtimeout\u001b[49m\u001b[43m)\u001b[49m\n\u001b[0;32m    506\u001b[0m     \u001b[38;5;28;01mexcept\u001b[39;00m TimeoutExpired \u001b[38;5;28;01mas\u001b[39;00m exc:\n\u001b[0;32m    507\u001b[0m         process\u001b[38;5;241m.\u001b[39mkill()\n",
      "File \u001b[1;32m~\\anaconda3\\envs\\llm\\lib\\subprocess.py:1141\u001b[0m, in \u001b[0;36mPopen.communicate\u001b[1;34m(self, input, timeout)\u001b[0m\n\u001b[0;32m   1139\u001b[0m     \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_stdin_write(\u001b[38;5;28minput\u001b[39m)\n\u001b[0;32m   1140\u001b[0m \u001b[38;5;28;01melif\u001b[39;00m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mstdout:\n\u001b[1;32m-> 1141\u001b[0m     stdout \u001b[38;5;241m=\u001b[39m \u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mstdout\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mread\u001b[49m\u001b[43m(\u001b[49m\u001b[43m)\u001b[49m\n\u001b[0;32m   1142\u001b[0m     \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mstdout\u001b[38;5;241m.\u001b[39mclose()\n\u001b[0;32m   1143\u001b[0m \u001b[38;5;28;01melif\u001b[39;00m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mstderr:\n",
      "\u001b[1;31mUnicodeDecodeError\u001b[0m: 'cp949' codec can't decode byte 0xe2 in position 3891: illegal multibyte sequence"
     ]
    }
   ],
   "source": [
    "import os, subprocess, textwrap, sys, pathlib\n",
    "\n",
    "cmd = r'findstr /s /n /i \"tax-index-upstage\" *.py *.ipynb'\n",
    "print(\"RUN:\", cmd)\n",
    "print(subprocess.getoutput(cmd))\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "9577dc7a",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "SKIP (not found): ch9.09_chromapinecone Ȱ RAG(upstage Embedding).ipynb\n",
      "SKIP (not found): ch9.10_Retrieval ȿ  ó(table).ipynb\n"
     ]
    }
   ],
   "source": [
    "from pathlib import Path\n",
    "\n",
    "targets = [\n",
    "    Path(\"ch9.09_chromapinecone Ȱ RAG(upstage Embedding).ipynb\"),\n",
    "    Path(\"ch9.10_Retrieval ȿ  ó(table).ipynb\"),\n",
    "]\n",
    "\n",
    "old = \"tax-index-upstage\"\n",
    "new = \"tax-index\"\n",
    "\n",
    "for fp in targets:\n",
    "    if not fp.exists():\n",
    "        print(\"SKIP (not found):\", fp)\n",
    "        continue\n",
    "\n",
    "    text = fp.read_text(encoding=\"utf-8\", errors=\"ignore\")\n",
    "    if old not in text:\n",
    "        print(\"NO CHANGE:\", fp)\n",
    "        continue\n",
    "\n",
    "    fp.write_text(text.replace(old, new), encoding=\"utf-8\")\n",
    "    print(\"UPDATED:\", fp)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "4f36ad4a",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "ipynb count: 18\n",
      "FOUND: 'ch9.09_chroma→pinecone을 활용한 RAG구현(upstage Embedding).ipynb'\n",
      "FOUND: 'ch9.10_Retrieval의 효율개선을 위한 전처리(table).ipynb'\n"
     ]
    }
   ],
   "source": [
    "from pathlib import Path\n",
    "\n",
    "ipynbs = sorted(Path(\".\").glob(\"*.ipynb\"))\n",
    "print(\"ipynb count:\", len(ipynbs))\n",
    "\n",
    "for p in ipynbs:\n",
    "    name = p.name\n",
    "    if (\"ch9.09\" in name) or (\"ch9.10\" in name) or (\"chromapinecone\" in name) or (\"Retrieval\" in name):\n",
    "        print(\"FOUND:\", repr(name))\n",
    "\n",
    "    "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "b719252d",
   "metadata": {},
   "outputs": [],
   "source": [
    "from pathlib import Path\n",
    "import shutil\n",
    "\n",
    "targets = [\n",
    "    Path(\"ch9.09_chroma→pinecone을 활용한 RAG구현(upstage Embedding).ipynb\"),\n",
    "    Path(\"ch9.10_Retrieval의 효율개선을 위한 전처리(table).ipynb\"),\n",
    "]\n",
    "\n",
    "old = \"tax-index-upstage\"\n",
    "new = \"tax-index\"\n",
    "\n",
    "for fp in targets:\n",
    "    if not fp.exists():\n",
    "        print(\"MISSING:\", repr(fp.name))\n",
    "        continue\n",
    "\n",
    "    text = fp.read_text(encoding=\"utf-8\", errors=\"ignore\")\n",
    "    cnt = text.count(old)\n",
    "    print(f\"\\nFILE: {fp.name}\")\n",
    "    print(\"  occurrences:\", cnt)\n",
    "\n",
    "    if cnt == 0:\n",
    "        print(\"  -> nothing to replace\")\n",
    "        continue\n",
    "\n",
    "    # 백업\n",
    "    backup = fp.with_suffix(fp.suffix + \".bak\")\n",
    "    shutil.copy2(fp, backup)\n",
    "\n",
    "    # 치환\n",
    "    fp.write_text(text.replace(old, new), encoding=\"utf-8\")\n",
    "    print(\"  -> updated OK | backup:\", backup.name)\n",
    "\n",
    "    "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "d725e263",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "ch9.09_chroma→pinecone을 활용한 RAG구현(upstage Embedding).ipynb | has 'tax-index-upstage' ? True\n",
      "ch9.09_chroma→pinecone을 활용한 RAG구현(upstage Embedding).ipynb | has 'tax-index' ? True\n",
      "ch9.10_Retrieval의 효율개선을 위한 전처리(table).ipynb | has 'tax-index-upstage' ? True\n",
      "ch9.10_Retrieval의 효율개선을 위한 전처리(table).ipynb | has 'tax-index' ? True\n"
     ]
    }
   ],
   "source": [
    "from pathlib import Path\n",
    "\n",
    "for fp in [\n",
    "    Path(\"ch9.09_chroma→pinecone을 활용한 RAG구현(upstage Embedding).ipynb\"),\n",
    "    Path(\"ch9.10_Retrieval의 효율개선을 위한 전처리(table).ipynb\"),\n",
    "]:\n",
    "    text = fp.read_text(encoding=\"utf-8\", errors=\"ignore\")\n",
    "    print(fp.name, \"| has 'tax-index-upstage' ?\", \"tax-index-upstage\" in text)\n",
    "    print(fp.name, \"| has 'tax-index' ?\", \"tax-index\" in text)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "93fb750c",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "== ch9.09_chroma→pinecone을 활용한 RAG구현(upstage Embedding).ipynb hits: 28\n",
      "\n",
      "(line 87)\n",
      "     \"output_type\": \"stream\",\n",
      "     \"text\": [\n",
      "      \".ipynb_checkpoints\\\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:469:     \\\"evalue\\\": \\\"(404)\\\\nReason: Not Found\\\\nHTTP response headers: HTTPHeaderDict({'content-type': 'text/plain; charset=utf-8', 'access-control-allow-origin': '*', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-expose-headers': '*', 'x-pinecone-api-version': '2025-04', 'x-cloud-trace-context': '8c9b5055b9aedb7fa23ec2b90a573dba', 'date': 'Fri, 09 Jan 2026 03:07:13 GMT', 'server': 'Google Frontend', 'Content-Length': '92', 'Via': '1.1 google', 'Alt-Svc': 'h3=\\\\\\\":443\\\\\\\"; ma=2592000,h3-29=\\\\\\\":443\\\\\\\"; ma=2592000'})\\\\nHTTP response body: {\\\\\\\"error\\\\\\\":{\\\\\\\"code\\\\\\\":\\\\\\\"NOT_FOUND\\\\\\\",\\\\\\\"message\\\\\\\":\\\\\\\"Resource tax-index-upstage not found\\\\\\\"},\\\\\\\"status\\\\\\\":404}\\\\n\\\",\\n\",\n",
      "      \".ipynb_checkpoints\\\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:489:      \\\"\\\\u001b[1;31mNotFoundException\\\\u001b[0m: (404)\\\\nReason: Not Found\\\\nHTTP response headers: HTTPHeaderDict({'content-type': 'text/plain; charset=utf-8', 'access-control-allow-origin': '*', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-expose-headers': '*', 'x-pinecone-api-version': '2025-04', 'x-cloud-trace-context': '8c9b5055b9aedb7fa23ec2b90a573dba', 'date': 'Fri, 09 Jan 2026 03:07:13 GMT', 'server': 'Google Frontend', 'Content-Length': '92', 'Via': '1.1 google', 'Alt-Svc': 'h3=\\\\\\\":443\\\\\\\"; ma=2592000,h3-29=\\\\\\\":443\\\\\\\"; ma=2592000'})\\\\nHTTP response body: {\\\\\\\"error\\\\\\\":{\\\\\\\"code\\\\\\\":\\\\\\\"NOT_FOUND\\\\\\\",\\\\\\\"message\\\\\\\":\\\\\\\"Resource tax-index-upstage not found\\\\\\\"},\\\\\\\"status\\\\\\\":404}\\\\n\\\"\\n\",\n",
      "      \".ipynb_checkpoints\\\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:503:    \\\"index_name = \\\\\\\"tax-index-upstage\\\\\\\"\\\\n\\\",\\n\",\n",
      "\n",
      "(line 88)\n",
      "     \"text\": [\n",
      "      \".ipynb_checkpoints\\\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:469:     \\\"evalue\\\": \\\"(404)\\\\nReason: Not Found\\\\nHTTP response headers: HTTPHeaderDict({'content-type': 'text/plain; charset=utf-8', 'access-control-allow-origin': '*', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-expose-headers': '*', 'x-pinecone-api-version': '2025-04', 'x-cloud-trace-context': '8c9b5055b9aedb7fa23ec2b90a573dba', 'date': 'Fri, 09 Jan 2026 03:07:13 GMT', 'server': 'Google Frontend', 'Content-Length': '92', 'Via': '1.1 google', 'Alt-Svc': 'h3=\\\\\\\":443\\\\\\\"; ma=2592000,h3-29=\\\\\\\":443\\\\\\\"; ma=2592000'})\\\\nHTTP response body: {\\\\\\\"error\\\\\\\":{\\\\\\\"code\\\\\\\":\\\\\\\"NOT_FOUND\\\\\\\",\\\\\\\"message\\\\\\\":\\\\\\\"Resource tax-index-upstage not found\\\\\\\"},\\\\\\\"status\\\\\\\":404}\\\\n\\\",\\n\",\n",
      "      \".ipynb_checkpoints\\\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:489:      \\\"\\\\u001b[1;31mNotFoundException\\\\u001b[0m: (404)\\\\nReason: Not Found\\\\nHTTP response headers: HTTPHeaderDict({'content-type': 'text/plain; charset=utf-8', 'access-control-allow-origin': '*', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-expose-headers': '*', 'x-pinecone-api-version': '2025-04', 'x-cloud-trace-context': '8c9b5055b9aedb7fa23ec2b90a573dba', 'date': 'Fri, 09 Jan 2026 03:07:13 GMT', 'server': 'Google Frontend', 'Content-Length': '92', 'Via': '1.1 google', 'Alt-Svc': 'h3=\\\\\\\":443\\\\\\\"; ma=2592000,h3-29=\\\\\\\":443\\\\\\\"; ma=2592000'})\\\\nHTTP response body: {\\\\\\\"error\\\\\\\":{\\\\\\\"code\\\\\\\":\\\\\\\"NOT_FOUND\\\\\\\",\\\\\\\"message\\\\\\\":\\\\\\\"Resource tax-index-upstage not found\\\\\\\"},\\\\\\\"status\\\\\\\":404}\\\\n\\\"\\n\",\n",
      "      \".ipynb_checkpoints\\\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:503:    \\\"index_name = \\\\\\\"tax-index-upstage\\\\\\\"\\\\n\\\",\\n\",\n",
      "      \".ipynb_checkpoints\\\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:786:     \\\"evalue\\\": \\\"(404)\\\\nReason: Not Found\\\\nHTTP response headers: HTTPHeaderDict({'content-type': 'text/plain; charset=utf-8', 'access-control-allow-origin': '*', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-expose-headers': '*', 'x-pinecone-api-version': '2025-04', 'x-cloud-trace-context': '208d662a4af4e3f3057cf1c2efdb6ab5', 'date': 'Fri, 09 Jan 2026 03:05:11 GMT', 'server': 'Google Frontend', 'Content-Length': '92', 'Via': '1.1 google', 'Alt-Svc': 'h3=\\\\\\\":443\\\\\\\"; ma=2592000,h3-29=\\\\\\\":443\\\\\\\"; ma=2592000'})\\\\nHTTP response body: {\\\\\\\"error\\\\\\\":{\\\\\\\"code\\\\\\\":\\\\\\\"NOT_FOUND\\\\\\\",\\\\\\\"message\\\\\\\":\\\\\\\"Resource tax-index-upstage not found\\\\\\\"},\\\\\\\"status\\\\\\\":404}\\\\n\\\",\\n\",\n",
      "\n",
      "(line 89)\n",
      "      \".ipynb_checkpoints\\\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:469:     \\\"evalue\\\": \\\"(404)\\\\nReason: Not Found\\\\nHTTP response headers: HTTPHeaderDict({'content-type': 'text/plain; charset=utf-8', 'access-control-allow-origin': '*', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-expose-headers': '*', 'x-pinecone-api-version': '2025-04', 'x-cloud-trace-context': '8c9b5055b9aedb7fa23ec2b90a573dba', 'date': 'Fri, 09 Jan 2026 03:07:13 GMT', 'server': 'Google Frontend', 'Content-Length': '92', 'Via': '1.1 google', 'Alt-Svc': 'h3=\\\\\\\":443\\\\\\\"; ma=2592000,h3-29=\\\\\\\":443\\\\\\\"; ma=2592000'})\\\\nHTTP response body: {\\\\\\\"error\\\\\\\":{\\\\\\\"code\\\\\\\":\\\\\\\"NOT_FOUND\\\\\\\",\\\\\\\"message\\\\\\\":\\\\\\\"Resource tax-index-upstage not found\\\\\\\"},\\\\\\\"status\\\\\\\":404}\\\\n\\\",\\n\",\n",
      "      \".ipynb_checkpoints\\\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:489:      \\\"\\\\u001b[1;31mNotFoundException\\\\u001b[0m: (404)\\\\nReason: Not Found\\\\nHTTP response headers: HTTPHeaderDict({'content-type': 'text/plain; charset=utf-8', 'access-control-allow-origin': '*', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-expose-headers': '*', 'x-pinecone-api-version': '2025-04', 'x-cloud-trace-context': '8c9b5055b9aedb7fa23ec2b90a573dba', 'date': 'Fri, 09 Jan 2026 03:07:13 GMT', 'server': 'Google Frontend', 'Content-Length': '92', 'Via': '1.1 google', 'Alt-Svc': 'h3=\\\\\\\":443\\\\\\\"; ma=2592000,h3-29=\\\\\\\":443\\\\\\\"; ma=2592000'})\\\\nHTTP response body: {\\\\\\\"error\\\\\\\":{\\\\\\\"code\\\\\\\":\\\\\\\"NOT_FOUND\\\\\\\",\\\\\\\"message\\\\\\\":\\\\\\\"Resource tax-index-upstage not found\\\\\\\"},\\\\\\\"status\\\\\\\":404}\\\\n\\\"\\n\",\n",
      "      \".ipynb_checkpoints\\\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:503:    \\\"index_name = \\\\\\\"tax-index-upstage\\\\\\\"\\\\n\\\",\\n\",\n",
      "      \".ipynb_checkpoints\\\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:786:     \\\"evalue\\\": \\\"(404)\\\\nReason: Not Found\\\\nHTTP response headers: HTTPHeaderDict({'content-type': 'text/plain; charset=utf-8', 'access-control-allow-origin': '*', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-expose-headers': '*', 'x-pinecone-api-version': '2025-04', 'x-cloud-trace-context': '208d662a4af4e3f3057cf1c2efdb6ab5', 'date': 'Fri, 09 Jan 2026 03:05:11 GMT', 'server': 'Google Frontend', 'Content-Length': '92', 'Via': '1.1 google', 'Alt-Svc': 'h3=\\\\\\\":443\\\\\\\"; ma=2592000,h3-29=\\\\\\\":443\\\\\\\"; ma=2592000'})\\\\nHTTP response body: {\\\\\\\"error\\\\\\\":{\\\\\\\"code\\\\\\\":\\\\\\\"NOT_FOUND\\\\\\\",\\\\\\\"message\\\\\\\":\\\\\\\"Resource tax-index-upstage not found\\\\\\\"},\\\\\\\"status\\\\\\\":404}\\\\n\\\",\\n\",\n",
      "      \".ipynb_checkpoints\\\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:806:      \\\"\\\\u001b[1;31mNotFoundException\\\\u001b[0m: (404)\\\\nReason: Not Found\\\\nHTTP response headers: HTTPHeaderDict({'content-type': 'text/plain; charset=utf-8', 'access-control-allow-origin': '*', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-expose-headers': '*', 'x-pinecone-api-version': '2025-04', 'x-cloud-trace-context': '208d662a4af4e3f3057cf1c2efdb6ab5', 'date': 'Fri, 09 Jan 2026 03:05:11 GMT', 'server': 'Google Frontend', 'Content-Length': '92', 'Via': '1.1 google', 'Alt-Svc': 'h3=\\\\\\\":443\\\\\\\"; ma=2592000,h3-29=\\\\\\\":443\\\\\\\"; ma=2592000'})\\\\nHTTP response body: {\\\\\\\"error\\\\\\\":{\\\\\\\"code\\\\\\\":\\\\\\\"NOT_FOUND\\\\\\\",\\\\\\\"message\\\\\\\":\\\\\\\"Resource tax-index-upstage not found\\\\\\\"},\\\\\\\"status\\\\\\\":404}\\\\n\\\"\\n\",\n",
      "\n",
      "(line 90)\n",
      "      \".ipynb_checkpoints\\\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:489:      \\\"\\\\u001b[1;31mNotFoundException\\\\u001b[0m: (404)\\\\nReason: Not Found\\\\nHTTP response headers: HTTPHeaderDict({'content-type': 'text/plain; charset=utf-8', 'access-control-allow-origin': '*', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-expose-headers': '*', 'x-pinecone-api-version': '2025-04', 'x-cloud-trace-context': '8c9b5055b9aedb7fa23ec2b90a573dba', 'date': 'Fri, 09 Jan 2026 03:07:13 GMT', 'server': 'Google Frontend', 'Content-Length': '92', 'Via': '1.1 google', 'Alt-Svc': 'h3=\\\\\\\":443\\\\\\\"; ma=2592000,h3-29=\\\\\\\":443\\\\\\\"; ma=2592000'})\\\\nHTTP response body: {\\\\\\\"error\\\\\\\":{\\\\\\\"code\\\\\\\":\\\\\\\"NOT_FOUND\\\\\\\",\\\\\\\"message\\\\\\\":\\\\\\\"Resource tax-index-upstage not found\\\\\\\"},\\\\\\\"status\\\\\\\":404}\\\\n\\\"\\n\",\n",
      "      \".ipynb_checkpoints\\\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:503:    \\\"index_name = \\\\\\\"tax-index-upstage\\\\\\\"\\\\n\\\",\\n\",\n",
      "      \".ipynb_checkpoints\\\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:786:     \\\"evalue\\\": \\\"(404)\\\\nReason: Not Found\\\\nHTTP response headers: HTTPHeaderDict({'content-type': 'text/plain; charset=utf-8', 'access-control-allow-origin': '*', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-expose-headers': '*', 'x-pinecone-api-version': '2025-04', 'x-cloud-trace-context': '208d662a4af4e3f3057cf1c2efdb6ab5', 'date': 'Fri, 09 Jan 2026 03:05:11 GMT', 'server': 'Google Frontend', 'Content-Length': '92', 'Via': '1.1 google', 'Alt-Svc': 'h3=\\\\\\\":443\\\\\\\"; ma=2592000,h3-29=\\\\\\\":443\\\\\\\"; ma=2592000'})\\\\nHTTP response body: {\\\\\\\"error\\\\\\\":{\\\\\\\"code\\\\\\\":\\\\\\\"NOT_FOUND\\\\\\\",\\\\\\\"message\\\\\\\":\\\\\\\"Resource tax-index-upstage not found\\\\\\\"},\\\\\\\"status\\\\\\\":404}\\\\n\\\",\\n\",\n",
      "      \".ipynb_checkpoints\\\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:806:      \\\"\\\\u001b[1;31mNotFoundException\\\\u001b[0m: (404)\\\\nReason: Not Found\\\\nHTTP response headers: HTTPHeaderDict({'content-type': 'text/plain; charset=utf-8', 'access-control-allow-origin': '*', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-expose-headers': '*', 'x-pinecone-api-version': '2025-04', 'x-cloud-trace-context': '208d662a4af4e3f3057cf1c2efdb6ab5', 'date': 'Fri, 09 Jan 2026 03:05:11 GMT', 'server': 'Google Frontend', 'Content-Length': '92', 'Via': '1.1 google', 'Alt-Svc': 'h3=\\\\\\\":443\\\\\\\"; ma=2592000,h3-29=\\\\\\\":443\\\\\\\"; ma=2592000'})\\\\nHTTP response body: {\\\\\\\"error\\\\\\\":{\\\\\\\"code\\\\\\\":\\\\\\\"NOT_FOUND\\\\\\\",\\\\\\\"message\\\\\\\":\\\\\\\"Resource tax-index-upstage not found\\\\\\\"},\\\\\\\"status\\\\\\\":404}\\\\n\\\"\\n\",\n",
      "      \".ipynb_checkpoints\\\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:899:    \\\"    index_name=\\\\\\\"tax-index-upstage\\\\\\\"\\\\n\\\",\\n\",\n",
      "\n",
      "(line 91)\n",
      "      \".ipynb_checkpoints\\\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:503:    \\\"index_name = \\\\\\\"tax-index-upstage\\\\\\\"\\\\n\\\",\\n\",\n",
      "      \".ipynb_checkpoints\\\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:786:     \\\"evalue\\\": \\\"(404)\\\\nReason: Not Found\\\\nHTTP response headers: HTTPHeaderDict({'content-type': 'text/plain; charset=utf-8', 'access-control-allow-origin': '*', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-expose-headers': '*', 'x-pinecone-api-version': '2025-04', 'x-cloud-trace-context': '208d662a4af4e3f3057cf1c2efdb6ab5', 'date': 'Fri, 09 Jan 2026 03:05:11 GMT', 'server': 'Google Frontend', 'Content-Length': '92', 'Via': '1.1 google', 'Alt-Svc': 'h3=\\\\\\\":443\\\\\\\"; ma=2592000,h3-29=\\\\\\\":443\\\\\\\"; ma=2592000'})\\\\nHTTP response body: {\\\\\\\"error\\\\\\\":{\\\\\\\"code\\\\\\\":\\\\\\\"NOT_FOUND\\\\\\\",\\\\\\\"message\\\\\\\":\\\\\\\"Resource tax-index-upstage not found\\\\\\\"},\\\\\\\"status\\\\\\\":404}\\\\n\\\",\\n\",\n",
      "      \".ipynb_checkpoints\\\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:806:      \\\"\\\\u001b[1;31mNotFoundException\\\\u001b[0m: (404)\\\\nReason: Not Found\\\\nHTTP response headers: HTTPHeaderDict({'content-type': 'text/plain; charset=utf-8', 'access-control-allow-origin': '*', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-expose-headers': '*', 'x-pinecone-api-version': '2025-04', 'x-cloud-trace-context': '208d662a4af4e3f3057cf1c2efdb6ab5', 'date': 'Fri, 09 Jan 2026 03:05:11 GMT', 'server': 'Google Frontend', 'Content-Length': '92', 'Via': '1.1 google', 'Alt-Svc': 'h3=\\\\\\\":443\\\\\\\"; ma=2592000,h3-29=\\\\\\\":443\\\\\\\"; ma=2592000'})\\\\nHTTP response body: {\\\\\\\"error\\\\\\\":{\\\\\\\"code\\\\\\\":\\\\\\\"NOT_FOUND\\\\\\\",\\\\\\\"message\\\\\\\":\\\\\\\"Resource tax-index-upstage not found\\\\\\\"},\\\\\\\"status\\\\\\\":404}\\\\n\\\"\\n\",\n",
      "      \".ipynb_checkpoints\\\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:899:    \\\"    index_name=\\\\\\\"tax-index-upstage\\\\\\\"\\\\n\\\",\\n\",\n",
      "      \".ipynb_checkpoints\\\\ch9.10_Retrieval ȿ  ó(table)-checkpoint.ipynb:420:    \\\"index_name = \\\\\\\"tax-index-upstage\\\\\\\"\\\\n\\\",\\n\",\n",
      "\n",
      "(line 92)\n",
      "      \".ipynb_checkpoints\\\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:786:     \\\"evalue\\\": \\\"(404)\\\\nReason: Not Found\\\\nHTTP response headers: HTTPHeaderDict({'content-type': 'text/plain; charset=utf-8', 'access-control-allow-origin': '*', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-expose-headers': '*', 'x-pinecone-api-version': '2025-04', 'x-cloud-trace-context': '208d662a4af4e3f3057cf1c2efdb6ab5', 'date': 'Fri, 09 Jan 2026 03:05:11 GMT', 'server': 'Google Frontend', 'Content-Length': '92', 'Via': '1.1 google', 'Alt-Svc': 'h3=\\\\\\\":443\\\\\\\"; ma=2592000,h3-29=\\\\\\\":443\\\\\\\"; ma=2592000'})\\\\nHTTP response body: {\\\\\\\"error\\\\\\\":{\\\\\\\"code\\\\\\\":\\\\\\\"NOT_FOUND\\\\\\\",\\\\\\\"message\\\\\\\":\\\\\\\"Resource tax-index-upstage not found\\\\\\\"},\\\\\\\"status\\\\\\\":404}\\\\n\\\",\\n\",\n",
      "      \".ipynb_checkpoints\\\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:806:      \\\"\\\\u001b[1;31mNotFoundException\\\\u001b[0m: (404)\\\\nReason: Not Found\\\\nHTTP response headers: HTTPHeaderDict({'content-type': 'text/plain; charset=utf-8', 'access-control-allow-origin': '*', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-expose-headers': '*', 'x-pinecone-api-version': '2025-04', 'x-cloud-trace-context': '208d662a4af4e3f3057cf1c2efdb6ab5', 'date': 'Fri, 09 Jan 2026 03:05:11 GMT', 'server': 'Google Frontend', 'Content-Length': '92', 'Via': '1.1 google', 'Alt-Svc': 'h3=\\\\\\\":443\\\\\\\"; ma=2592000,h3-29=\\\\\\\":443\\\\\\\"; ma=2592000'})\\\\nHTTP response body: {\\\\\\\"error\\\\\\\":{\\\\\\\"code\\\\\\\":\\\\\\\"NOT_FOUND\\\\\\\",\\\\\\\"message\\\\\\\":\\\\\\\"Resource tax-index-upstage not found\\\\\\\"},\\\\\\\"status\\\\\\\":404}\\\\n\\\"\\n\",\n",
      "      \".ipynb_checkpoints\\\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:899:    \\\"    index_name=\\\\\\\"tax-index-upstage\\\\\\\"\\\\n\\\",\\n\",\n",
      "      \".ipynb_checkpoints\\\\ch9.10_Retrieval ȿ  ó(table)-checkpoint.ipynb:420:    \\\"index_name = \\\\\\\"tax-index-upstage\\\\\\\"\\\\n\\\",\\n\",\n",
      "      \"ch9.09_chromapinecone Ȱ RAG(upstage Embedding).ipynb:126:      \\\"RUN: findstr /s /n /i \\\\\\\"tax-index-upstage\\\\\\\" *.py *.ipynb\\\\n\\\"\\n\",\n",
      "\n",
      "(line 93)\n",
      "      \".ipynb_checkpoints\\\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:806:      \\\"\\\\u001b[1;31mNotFoundException\\\\u001b[0m: (404)\\\\nReason: Not Found\\\\nHTTP response headers: HTTPHeaderDict({'content-type': 'text/plain; charset=utf-8', 'access-control-allow-origin': '*', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-expose-headers': '*', 'x-pinecone-api-version': '2025-04', 'x-cloud-trace-context': '208d662a4af4e3f3057cf1c2efdb6ab5', 'date': 'Fri, 09 Jan 2026 03:05:11 GMT', 'server': 'Google Frontend', 'Content-Length': '92', 'Via': '1.1 google', 'Alt-Svc': 'h3=\\\\\\\":443\\\\\\\"; ma=2592000,h3-29=\\\\\\\":443\\\\\\\"; ma=2592000'})\\\\nHTTP response body: {\\\\\\\"error\\\\\\\":{\\\\\\\"code\\\\\\\":\\\\\\\"NOT_FOUND\\\\\\\",\\\\\\\"message\\\\\\\":\\\\\\\"Resource tax-index-upstage not found\\\\\\\"},\\\\\\\"status\\\\\\\":404}\\\\n\\\"\\n\",\n",
      "      \".ipynb_checkpoints\\\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:899:    \\\"    index_name=\\\\\\\"tax-index-upstage\\\\\\\"\\\\n\\\",\\n\",\n",
      "      \".ipynb_checkpoints\\\\ch9.10_Retrieval ȿ  ó(table)-checkpoint.ipynb:420:    \\\"index_name = \\\\\\\"tax-index-upstage\\\\\\\"\\\\n\\\",\\n\",\n",
      "      \"ch9.09_chromapinecone Ȱ RAG(upstage Embedding).ipynb:126:      \\\"RUN: findstr /s /n /i \\\\\\\"tax-index-upstage\\\\\\\" *.py *.ipynb\\\\n\\\"\\n\",\n",
      "      \"ch9.09_chromapinecone Ȱ RAG(upstage Embedding).ipynb:136:      \\\"Cell \\\\u001b[1;32mIn[6], line 5\\\\u001b[0m\\\\n\\\\u001b[0;32m      3\\\\u001b[0m cmd \\\\u001b[38;5;241m=\\\\u001b[39m \\\\u001b[38;5;124mr\\\\u001b[39m\\\\u001b[38;5;124m'\\\\u001b[39m\\\\u001b[38;5;124mfindstr /s /n /i \\\\u001b[39m\\\\u001b[38;5;124m\\\\\\\"\\\\u001b[39m\\\\u001b[38;5;124mtax-index-upstage\\\\u001b[39m\\\\u001b[38;5;124m\\\\\\\"\\\\u001b[39m\\\\u001b[38;5;124m *.py *.ipynb\\\\u001b[39m\\\\u001b[38;5;124m'\\\\u001b[39m\\\\n\\\\u001b[0;32m      4\\\\u001b[0m \\\\u001b[38;5;28mprint\\\\u001b[39m(\\\\u001b[38;5;124m\\\\\\\"\\\\u001b[39m\\\\u001b[38;5;124mRUN:\\\\u001b[39m\\\\u001b[38;5;124m\\\\\\\"\\\\u001b[39m, cmd)\\\\n\\\\u001b[1;32m----> 5\\\\u001b[0m \\\\u001b[38;5;28mprint\\\\u001b[39m(\\\\u001b[43msubprocess\\\\u001b[49m\\\\u001b[38;5;241;43m.\\\\u001b[39;49m\\\\u001b[43mgetoutput\\\\u001b[49m\\\\u001b[43m(\\\\u001b[49m\\\\u001b[43mcmd\\\\u001b[49m\\\\u001b[43m)\\\\u001b[49m)\\\\n\\\",\\n\",\n",
      "\n",
      "(line 94)\n",
      "      \".ipynb_checkpoints\\\\ch9.09_chromapinecone Ȱ RAG(upstage Embedding)-checkpoint.ipynb:899:    \\\"    index_name=\\\\\\\"tax-index-upstage\\\\\\\"\\\\n\\\",\\n\",\n",
      "      \".ipynb_checkpoints\\\\ch9.10_Retrieval ȿ  ó(table)-checkpoint.ipynb:420:    \\\"index_name = \\\\\\\"tax-index-upstage\\\\\\\"\\\\n\\\",\\n\",\n",
      "      \"ch9.09_chromapinecone Ȱ RAG(upstage Embedding).ipynb:126:      \\\"RUN: findstr /s /n /i \\\\\\\"tax-index-upstage\\\\\\\" *.py *.ipynb\\\\n\\\"\\n\",\n",
      "      \"ch9.09_chromapinecone Ȱ RAG(upstage Embedding).ipynb:136:      \\\"Cell \\\\u001b[1;32mIn[6], line 5\\\\u001b[0m\\\\n\\\\u001b[0;32m      3\\\\u001b[0m cmd \\\\u001b[38;5;241m=\\\\u001b[39m \\\\u001b[38;5;124mr\\\\u001b[39m\\\\u001b[38;5;124m'\\\\u001b[39m\\\\u001b[38;5;124mfindstr /s /n /i \\\\u001b[39m\\\\u001b[38;5;124m\\\\\\\"\\\\u001b[39m\\\\u001b[38;5;124mtax-index-upstage\\\\u001b[39m\\\\u001b[38;5;124m\\\\\\\"\\\\u001b[39m\\\\u001b[38;5;124m *.py *.ipynb\\\\u001b[39m\\\\u001b[38;5;124m'\\\\u001b[39m\\\\n\\\\u001b[0;32m      4\\\\u001b[0m \\\\u001b[38;5;28mprint\\\\u001b[39m(\\\\u001b[38;5;124m\\\\\\\"\\\\u001b[39m\\\\u001b[38;5;124mRUN:\\\\u001b[39m\\\\u001b[38;5;124m\\\\\\\"\\\\u001b[39m, cmd)\\\\n\\\\u001b[1;32m----> 5\\\\u001b[0m \\\\u001b[38;5;28mprint\\\\u001b[39m(\\\\u001b[43msubprocess\\\\u001b[49m\\\\u001b[38;5;241;43m.\\\\u001b[39;49m\\\\u001b[43mgetoutput\\\\u001b[49m\\\\u001b[43m(\\\\u001b[49m\\\\u001b[43mcmd\\\\u001b[49m\\\\u001b[43m)\\\\u001b[49m)\\\\n\\\",\\n\",\n",
      "      \"ch9.09_chromapinecone Ȱ RAG(upstage Embedding).ipynb:149:    \\\"cmd = r'findstr /s /n /i \\\\\\\"tax-index-upstage\\\\\\\" *.py *.ipynb'\\\\n\\\",\\n\",\n",
      "\n",
      "(line 95)\n",
      "      \".ipynb_checkpoints\\\\ch9.10_Retrieval ȿ  ó(table)-checkpoint.ipynb:420:    \\\"index_name = \\\\\\\"tax-index-upstage\\\\\\\"\\\\n\\\",\\n\",\n",
      "      \"ch9.09_chromapinecone Ȱ RAG(upstage Embedding).ipynb:126:      \\\"RUN: findstr /s /n /i \\\\\\\"tax-index-upstage\\\\\\\" *.py *.ipynb\\\\n\\\"\\n\",\n",
      "      \"ch9.09_chromapinecone Ȱ RAG(upstage Embedding).ipynb:136:      \\\"Cell \\\\u001b[1;32mIn[6], line 5\\\\u001b[0m\\\\n\\\\u001b[0;32m      3\\\\u001b[0m cmd \\\\u001b[38;5;241m=\\\\u001b[39m \\\\u001b[38;5;124mr\\\\u001b[39m\\\\u001b[38;5;124m'\\\\u001b[39m\\\\u001b[38;5;124mfindstr /s /n /i \\\\u001b[39m\\\\u001b[38;5;124m\\\\\\\"\\\\u001b[39m\\\\u001b[38;5;124mtax-index-upstage\\\\u001b[39m\\\\u001b[38;5;124m\\\\\\\"\\\\u001b[39m\\\\u001b[38;5;124m *.py *.ipynb\\\\u001b[39m\\\\u001b[38;5;124m'\\\\u001b[39m\\\\n\\\\u001b[0;32m      4\\\\u001b[0m \\\\u001b[38;5;28mprint\\\\u001b[39m(\\\\u001b[38;5;124m\\\\\\\"\\\\u001b[39m\\\\u001b[38;5;124mRUN:\\\\u001b[39m\\\\u001b[38;5;124m\\\\\\\"\\\\u001b[39m, cmd)\\\\n\\\\u001b[1;32m----> 5\\\\u001b[0m \\\\u001b[38;5;28mprint\\\\u001b[39m(\\\\u001b[43msubprocess\\\\u001b[49m\\\\u001b[38;5;241;43m.\\\\u001b[39;49m\\\\u001b[43mgetoutput\\\\u001b[49m\\\\u001b[43m(\\\\u001b[49m\\\\u001b[43mcmd\\\\u001b[49m\\\\u001b[43m)\\\\u001b[49m)\\\\n\\\",\\n\",\n",
      "      \"ch9.09_chromapinecone Ȱ RAG(upstage Embedding).ipynb:149:    \\\"cmd = r'findstr /s /n /i \\\\\\\"tax-index-upstage\\\\\\\" *.py *.ipynb'\\\\n\\\",\\n\",\n",
      "      \"ch9.09_chromapinecone Ȱ RAG(upstage Embedding).ipynb:401:     \\\"evalue\\\": \\\"(404)\\\\nReason: Not Found\\\\nHTTP response headers: HTTPHeaderDict({'content-type': 'text/plain; charset=utf-8', 'access-control-allow-origin': '*', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-expose-headers': '*', 'x-pinecone-api-version': '2025-04', 'x-cloud-trace-context': '984b6cc04f966335fbc20b8d2889e464', 'date': 'Fri, 09 Jan 2026 03:38:21 GMT', 'server': 'Google Frontend', 'Content-Length': '92', 'Via': '1.1 google', 'Alt-Svc': 'h3=\\\\\\\":443\\\\\\\"; ma=2592000,h3-29=\\\\\\\":443\\\\\\\"; ma=2592000'})\\\\nHTTP response body: {\\\\\\\"error\\\\\\\":{\\\\\\\"code\\\\\\\":\\\\\\\"NOT_FOUND\\\\\\\",\\\\\\\"message\\\\\\\":\\\\\\\"Resource tax-index-upstage not found\\\\\\\"},\\\\\\\"status\\\\\\\":404}\\\\n\\\",\\n\",\n",
      "\n",
      "(line 96)\n",
      "      \"ch9.09_chromapinecone Ȱ RAG(upstage Embedding).ipynb:126:      \\\"RUN: findstr /s /n /i \\\\\\\"tax-index-upstage\\\\\\\" *.py *.ipynb\\\\n\\\"\\n\",\n",
      "      \"ch9.09_chromapinecone Ȱ RAG(upstage Embedding).ipynb:136:      \\\"Cell \\\\u001b[1;32mIn[6], line 5\\\\u001b[0m\\\\n\\\\u001b[0;32m      3\\\\u001b[0m cmd \\\\u001b[38;5;241m=\\\\u001b[39m \\\\u001b[38;5;124mr\\\\u001b[39m\\\\u001b[38;5;124m'\\\\u001b[39m\\\\u001b[38;5;124mfindstr /s /n /i \\\\u001b[39m\\\\u001b[38;5;124m\\\\\\\"\\\\u001b[39m\\\\u001b[38;5;124mtax-index-upstage\\\\u001b[39m\\\\u001b[38;5;124m\\\\\\\"\\\\u001b[39m\\\\u001b[38;5;124m *.py *.ipynb\\\\u001b[39m\\\\u001b[38;5;124m'\\\\u001b[39m\\\\n\\\\u001b[0;32m      4\\\\u001b[0m \\\\u001b[38;5;28mprint\\\\u001b[39m(\\\\u001b[38;5;124m\\\\\\\"\\\\u001b[39m\\\\u001b[38;5;124mRUN:\\\\u001b[39m\\\\u001b[38;5;124m\\\\\\\"\\\\u001b[39m, cmd)\\\\n\\\\u001b[1;32m----> 5\\\\u001b[0m \\\\u001b[38;5;28mprint\\\\u001b[39m(\\\\u001b[43msubprocess\\\\u001b[49m\\\\u001b[38;5;241;43m.\\\\u001b[39;49m\\\\u001b[43mgetoutput\\\\u001b[49m\\\\u001b[43m(\\\\u001b[49m\\\\u001b[43mcmd\\\\u001b[49m\\\\u001b[43m)\\\\u001b[49m)\\\\n\\\",\\n\",\n",
      "      \"ch9.09_chromapinecone Ȱ RAG(upstage Embedding).ipynb:149:    \\\"cmd = r'findstr /s /n /i \\\\\\\"tax-index-upstage\\\\\\\" *.py *.ipynb'\\\\n\\\",\\n\",\n",
      "      \"ch9.09_chromapinecone Ȱ RAG(upstage Embedding).ipynb:401:     \\\"evalue\\\": \\\"(404)\\\\nReason: Not Found\\\\nHTTP response headers: HTTPHeaderDict({'content-type': 'text/plain; charset=utf-8', 'access-control-allow-origin': '*', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-expose-headers': '*', 'x-pinecone-api-version': '2025-04', 'x-cloud-trace-context': '984b6cc04f966335fbc20b8d2889e464', 'date': 'Fri, 09 Jan 2026 03:38:21 GMT', 'server': 'Google Frontend', 'Content-Length': '92', 'Via': '1.1 google', 'Alt-Svc': 'h3=\\\\\\\":443\\\\\\\"; ma=2592000,h3-29=\\\\\\\":443\\\\\\\"; ma=2592000'})\\\\nHTTP response body: {\\\\\\\"error\\\\\\\":{\\\\\\\"code\\\\\\\":\\\\\\\"NOT_FOUND\\\\\\\",\\\\\\\"message\\\\\\\":\\\\\\\"Resource tax-index-upstage not found\\\\\\\"},\\\\\\\"status\\\\\\\":404}\\\\n\\\",\\n\",\n",
      "      \"ch9.09_chromapinecone Ȱ RAG(upstage Embedding).ipynb:421:      \\\"\\\\u001b[1;31mNotFoundException\\\\u001b[0m: (404)\\\\nReason: Not Found\\\\nHTTP response headers: HTTPHeaderDict({'content-type': 'text/plain; charset=utf-8', 'access-control-allow-origin': '*', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-expose-headers': '*', 'x-pinecone-api-version': '2025-04', 'x-cloud-trace-context': '984b6cc04f966335fbc20b8d2889e464', 'date': 'Fri, 09 Jan 2026 03:38:21 GMT', 'server': 'Google Frontend', 'Content-Length': '92', 'Via': '1.1 google', 'Alt-Svc': 'h3=\\\\\\\":443\\\\\\\"; ma=2592000,h3-29=\\\\\\\":443\\\\\\\"; ma=2592000'})\\\\nHTTP response body: {\\\\\\\"error\\\\\\\":{\\\\\\\"code\\\\\\\":\\\\\\\"NOT_FOUND\\\\\\\",\\\\\\\"message\\\\\\\":\\\\\\\"Resource tax-index-upstage not found\\\\\\\"},\\\\\\\"status\\\\\\\":404}\\\\n\\\"\\n\",\n",
      "\n",
      "== ch9.10_Retrieval의 효율개선을 위한 전처리(table).ipynb hits: 3\n",
      "\n",
      "(line 246)\n",
      "    {\n",
      "     \"ename\": \"NotFoundException\",\n",
      "     \"evalue\": \"(404)\\nReason: Not Found\\nHTTP response headers: HTTPHeaderDict({'content-type': 'text/plain; charset=utf-8', 'access-control-allow-origin': '*', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-expose-headers': '*', 'x-pinecone-api-version': '2025-04', 'x-cloud-trace-context': 'decd87773c66a7d39a168dec412c208c', 'date': 'Fri, 09 Jan 2026 02:05:50 GMT', 'server': 'Google Frontend', 'Content-Length': '92', 'Via': '1.1 google', 'Alt-Svc': 'h3=\\\":443\\\"; ma=2592000,h3-29=\\\":443\\\"; ma=2592000'})\\nHTTP response body: {\\\"error\\\":{\\\"code\\\":\\\"NOT_FOUND\\\",\\\"message\\\":\\\"Resource tax-index-upstage not found\\\"},\\\"status\\\":404}\\n\",\n",
      "     \"output_type\": \"error\",\n",
      "     \"traceback\": [\n",
      "\n",
      "(line 266)\n",
      "      \"File \\u001b[1;32m~\\\\anaconda3\\\\envs\\\\llm\\\\lib\\\\site-packages\\\\pinecone\\\\openapi_support\\\\rest_urllib3.py:267\\u001b[0m, in \\u001b[0;36mUrllib3RestClient.request\\u001b[1;34m(self, method, url, query_params, headers, body, post_params, _preload_content, _request_timeout)\\u001b[0m\\n\\u001b[0;32m    264\\u001b[0m     \\u001b[38;5;66;03m# log response body\\u001b[39;00m\\n\\u001b[0;32m    265\\u001b[0m     logger\\u001b[38;5;241m.\\u001b[39mdebug(\\u001b[38;5;124m\\\"\\u001b[39m\\u001b[38;5;124mresponse body: \\u001b[39m\\u001b[38;5;132;01m%s\\u001b[39;00m\\u001b[38;5;124m\\\"\\u001b[39m, r\\u001b[38;5;241m.\\u001b[39mdata)\\n\\u001b[1;32m--> 267\\u001b[0m \\u001b[38;5;28;01mreturn\\u001b[39;00m \\u001b[43mraise_exceptions_or_return\\u001b[49m\\u001b[43m(\\u001b[49m\\u001b[43mr\\u001b[49m\\u001b[43m)\\u001b[49m\\n\",\n",
      "      \"File \\u001b[1;32m~\\\\anaconda3\\\\envs\\\\llm\\\\lib\\\\site-packages\\\\pinecone\\\\openapi_support\\\\rest_utils.py:44\\u001b[0m, in \\u001b[0;36mraise_exceptions_or_return\\u001b[1;34m(r)\\u001b[0m\\n\\u001b[0;32m     41\\u001b[0m     \\u001b[38;5;28;01mraise\\u001b[39;00m ForbiddenException(http_resp\\u001b[38;5;241m=\\u001b[39mr)\\n\\u001b[0;32m     43\\u001b[0m \\u001b[38;5;28;01mif\\u001b[39;00m r\\u001b[38;5;241m.\\u001b[39mstatus \\u001b[38;5;241m==\\u001b[39m \\u001b[38;5;241m404\\u001b[39m:\\n\\u001b[1;32m---> 44\\u001b[0m     \\u001b[38;5;28;01mraise\\u001b[39;00m NotFoundException(http_resp\\u001b[38;5;241m=\\u001b[39mr)\\n\\u001b[0;32m     46\\u001b[0m \\u001b[38;5;28;01mif\\u001b[39;00m \\u001b[38;5;241m500\\u001b[39m \\u001b[38;5;241m<\\u001b[39m\\u001b[38;5;241m=\\u001b[39m r\\u001b[38;5;241m.\\u001b[39mstatus \\u001b[38;5;241m<\\u001b[39m\\u001b[38;5;241m=\\u001b[39m \\u001b[38;5;241m599\\u001b[39m:\\n\\u001b[0;32m     47\\u001b[0m     \\u001b[38;5;28;01mraise\\u001b[39;00m ServiceException(http_resp\\u001b[38;5;241m=\\u001b[39mr)\\n\",\n",
      "      \"\\u001b[1;31mNotFoundException\\u001b[0m: (404)\\nReason: Not Found\\nHTTP response headers: HTTPHeaderDict({'content-type': 'text/plain; charset=utf-8', 'access-control-allow-origin': '*', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-expose-headers': '*', 'x-pinecone-api-version': '2025-04', 'x-cloud-trace-context': 'decd87773c66a7d39a168dec412c208c', 'date': 'Fri, 09 Jan 2026 02:05:50 GMT', 'server': 'Google Frontend', 'Content-Length': '92', 'Via': '1.1 google', 'Alt-Svc': 'h3=\\\":443\\\"; ma=2592000,h3-29=\\\":443\\\"; ma=2592000'})\\nHTTP response body: {\\\"error\\\":{\\\"code\\\":\\\"NOT_FOUND\\\",\\\"message\\\":\\\"Resource tax-index-upstage not found\\\"},\\\"status\\\":404}\\n\"\n",
      "     ]\n",
      "    }\n",
      "\n",
      "(line 280)\n",
      "    \")\\n\",\n",
      "    \"# 데이터를 처음 업로드할 때\\n\",\n",
      "    \"index_name = \\\"tax-index-upstage\\\"\\n\",\n",
      "    \"# database = PineconeVectorStore.from_documents(\\n\",\n",
      "    \"#     documents=document_list,\\n\",\n"
     ]
    }
   ],
   "source": [
    "from pathlib import Path\n",
    "\n",
    "files = [\n",
    "    Path(\"ch9.09_chroma→pinecone을 활용한 RAG구현(upstage Embedding).ipynb\"),\n",
    "    Path(\"ch9.10_Retrieval의 효율개선을 위한 전처리(table).ipynb\"),\n",
    "]\n",
    "\n",
    "needle = \"tax-index-upstage\"\n",
    "\n",
    "for fp in files:\n",
    "    text = fp.read_text(encoding=\"utf-8\", errors=\"ignore\").splitlines()\n",
    "    hits = [i for i, line in enumerate(text) if needle in line]\n",
    "    print(\"\\n==\", fp.name, \"hits:\", len(hits))\n",
    "    for i in hits[:10]:  # 너무 많으면 10개만\n",
    "        start = max(0, i-2)\n",
    "        end = min(len(text), i+3)\n",
    "        print(f\"\\n(line {i+1})\")\n",
    "        for j in range(start, end):\n",
    "            print(text[j])\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "4e4517c5",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "INDEX_TAX: tax-index\n"
     ]
    }
   ],
   "source": [
    "print(\"INDEX_TAX:\", INDEX_TAX)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "76573d51",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "index_name => <NOT DEFINED>\n",
      "PINECONE_INDEX_NAME => <NOT DEFINED>\n",
      "INDEX_NAME => <NOT DEFINED>\n",
      "pinecone_index_name => <NOT DEFINED>\n",
      "ENV PINECONE_INDEX_NAME => None\n"
     ]
    }
   ],
   "source": [
    "# ✅ 어떤 이름으로든 upstage 인덱스가 남아있는지 확인\n",
    "suspects = [\"index_name\", \"PINECONE_INDEX_NAME\", \"INDEX_NAME\", \"pinecone_index_name\"]\n",
    "for s in suspects:\n",
    "    print(s, \"=>\", globals().get(s, \"<NOT DEFINED>\"))\n",
    "\n",
    "# 혹시 환경변수로도 박혀있을 수 있음\n",
    "import os\n",
    "print(\"ENV PINECONE_INDEX_NAME =>\", os.environ.get(\"PINECONE_INDEX_NAME\"))\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "fbcecd34",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "index_name removed? True\n",
      "ENV removed? True\n"
     ]
    }
   ],
   "source": [
    "# ✅ 강제 제거\n",
    "if \"index_name\" in globals():\n",
    "    del index_name\n",
    "print(\"index_name removed?\", \"index_name\" not in globals())\n",
    "\n",
    "import os\n",
    "if os.environ.get(\"PINECONE_INDEX_NAME\"):\n",
    "    os.environ.pop(\"PINECONE_INDEX_NAME\")\n",
    "print(\"ENV removed?\", os.environ.get(\"PINECONE_INDEX_NAME\") is None)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "a9715908",
   "metadata": {},
   "outputs": [
    {
     "ename": "OpenAIError",
     "evalue": "The api_key client option must be set either by passing api_key to the client or by setting the OPENAI_API_KEY environment variable",
     "output_type": "error",
     "traceback": [
      "\u001b[1;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[1;31mOpenAIError\u001b[0m                               Traceback (most recent call last)",
      "Cell \u001b[1;32mIn[10], line 13\u001b[0m\n\u001b[0;32m      5\u001b[0m     emb \u001b[38;5;241m=\u001b[39m OpenAIEmbeddings(model\u001b[38;5;241m=\u001b[39m\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mtext-embedding-3-small\u001b[39m\u001b[38;5;124m\"\u001b[39m)\n\u001b[0;32m      6\u001b[0m     \u001b[38;5;28;01mreturn\u001b[39;00m PineconeVectorStore(\n\u001b[0;32m      7\u001b[0m         index_name\u001b[38;5;241m=\u001b[39mINDEX_TAX,\n\u001b[0;32m      8\u001b[0m         embedding\u001b[38;5;241m=\u001b[39memb,\n\u001b[0;32m      9\u001b[0m         host\u001b[38;5;241m=\u001b[39mHOST_TAX,\n\u001b[0;32m     10\u001b[0m         namespace\u001b[38;5;241m=\u001b[39mNAMESPACE_TAX,\n\u001b[0;32m     11\u001b[0m     )\n\u001b[1;32m---> 13\u001b[0m vs_tax \u001b[38;5;241m=\u001b[39m \u001b[43mmake_tax_vectorstore\u001b[49m\u001b[43m(\u001b[49m\u001b[43m)\u001b[49m\n\u001b[0;32m     14\u001b[0m \u001b[38;5;28mprint\u001b[39m(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124m✅ vs_tax ready\u001b[39m\u001b[38;5;124m\"\u001b[39m)\n",
      "Cell \u001b[1;32mIn[10], line 5\u001b[0m, in \u001b[0;36mmake_tax_vectorstore\u001b[1;34m()\u001b[0m\n\u001b[0;32m      3\u001b[0m \u001b[38;5;28;01mfrom\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;21;01mlangchain_openai\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;28;01mimport\u001b[39;00m OpenAIEmbeddings\n\u001b[0;32m      4\u001b[0m \u001b[38;5;28;01mfrom\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;21;01mlangchain_pinecone\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;28;01mimport\u001b[39;00m PineconeVectorStore\n\u001b[1;32m----> 5\u001b[0m emb \u001b[38;5;241m=\u001b[39m \u001b[43mOpenAIEmbeddings\u001b[49m\u001b[43m(\u001b[49m\u001b[43mmodel\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[38;5;124;43mtext-embedding-3-small\u001b[39;49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[43m)\u001b[49m\n\u001b[0;32m      6\u001b[0m \u001b[38;5;28;01mreturn\u001b[39;00m PineconeVectorStore(\n\u001b[0;32m      7\u001b[0m     index_name\u001b[38;5;241m=\u001b[39mINDEX_TAX,\n\u001b[0;32m      8\u001b[0m     embedding\u001b[38;5;241m=\u001b[39memb,\n\u001b[0;32m      9\u001b[0m     host\u001b[38;5;241m=\u001b[39mHOST_TAX,\n\u001b[0;32m     10\u001b[0m     namespace\u001b[38;5;241m=\u001b[39mNAMESPACE_TAX,\n\u001b[0;32m     11\u001b[0m )\n",
      "    \u001b[1;31m[... skipping hidden 1 frame]\u001b[0m\n",
      "File \u001b[1;32m~\\anaconda3\\envs\\llm\\lib\\site-packages\\langchain_openai\\embeddings\\base.py:406\u001b[0m, in \u001b[0;36mOpenAIEmbeddings.validate_environment\u001b[1;34m(self)\u001b[0m\n\u001b[0;32m    401\u001b[0m         \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mhttp_async_client \u001b[38;5;241m=\u001b[39m httpx\u001b[38;5;241m.\u001b[39mAsyncClient(proxy\u001b[38;5;241m=\u001b[39m\u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mopenai_proxy)\n\u001b[0;32m    402\u001b[0m     async_specific \u001b[38;5;241m=\u001b[39m {\n\u001b[0;32m    403\u001b[0m         \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mhttp_client\u001b[39m\u001b[38;5;124m\"\u001b[39m: \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mhttp_async_client,\n\u001b[0;32m    404\u001b[0m         \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mapi_key\u001b[39m\u001b[38;5;124m\"\u001b[39m: async_api_key_value,\n\u001b[0;32m    405\u001b[0m     }\n\u001b[1;32m--> 406\u001b[0m     \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39masync_client \u001b[38;5;241m=\u001b[39m openai\u001b[38;5;241m.\u001b[39mAsyncOpenAI(\n\u001b[0;32m    407\u001b[0m         \u001b[38;5;241m*\u001b[39m\u001b[38;5;241m*\u001b[39mclient_params,\n\u001b[0;32m    408\u001b[0m         \u001b[38;5;241m*\u001b[39m\u001b[38;5;241m*\u001b[39masync_specific,  \u001b[38;5;66;03m# type: ignore[arg-type]\u001b[39;00m\n\u001b[0;32m    409\u001b[0m     )\u001b[38;5;241m.\u001b[39membeddings\n\u001b[0;32m    410\u001b[0m \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28mself\u001b[39m\n",
      "File \u001b[1;32m~\\anaconda3\\envs\\llm\\lib\\site-packages\\openai\\_client.py:488\u001b[0m, in \u001b[0;36mAsyncOpenAI.__init__\u001b[1;34m(self, api_key, organization, project, webhook_secret, base_url, websocket_base_url, timeout, max_retries, default_headers, default_query, http_client, _strict_response_validation)\u001b[0m\n\u001b[0;32m    486\u001b[0m     api_key \u001b[38;5;241m=\u001b[39m os\u001b[38;5;241m.\u001b[39menviron\u001b[38;5;241m.\u001b[39mget(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mOPENAI_API_KEY\u001b[39m\u001b[38;5;124m\"\u001b[39m)\n\u001b[0;32m    487\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m api_key \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;28;01mNone\u001b[39;00m:\n\u001b[1;32m--> 488\u001b[0m     \u001b[38;5;28;01mraise\u001b[39;00m OpenAIError(\n\u001b[0;32m    489\u001b[0m         \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mThe api_key client option must be set either by passing api_key to the client or by setting the OPENAI_API_KEY environment variable\u001b[39m\u001b[38;5;124m\"\u001b[39m\n\u001b[0;32m    490\u001b[0m     )\n\u001b[0;32m    491\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mcallable\u001b[39m(api_key):\n\u001b[0;32m    492\u001b[0m     \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mapi_key \u001b[38;5;241m=\u001b[39m \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124m\"\u001b[39m\n",
      "\u001b[1;31mOpenAIError\u001b[0m: The api_key client option must be set either by passing api_key to the client or by setting the OPENAI_API_KEY environment variable"
     ]
    }
   ],
   "source": [
    "def make_tax_vectorstore():\n",
    "    assert INDEX_TAX == \"tax-index\"\n",
    "    from langchain_openai import OpenAIEmbeddings\n",
    "    from langchain_pinecone import PineconeVectorStore\n",
    "    emb = OpenAIEmbeddings(model=\"text-embedding-3-small\")\n",
    "    return PineconeVectorStore(\n",
    "        index_name=INDEX_TAX,\n",
    "        embedding=emb,\n",
    "        host=HOST_TAX,\n",
    "        namespace=NAMESPACE_TAX,\n",
    "    )\n",
    "\n",
    "vs_tax = make_tax_vectorstore()\n",
    "print(\"✅ vs_tax ready\")\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "87476791",
   "metadata": {},
   "source": [
    "# 벡터DB : Chroma vs. Pinecone\n",
    "- Chroma : 인메모리 vector DB, 로컬 vector DB\n",
    "- Pinecone : 클라우드 vector DB\n",
    "    (https://www.pinecone.io에서 api key 생성 -> .env에 추가(PINECONE_API_KEY등록)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "a947624b",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "c902bcf2",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "markdown",
   "id": "67ce4a01",
   "metadata": {},
   "source": [
    "# 0. 패키지 설치"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "c22eca69",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Note: you may need to restart the kernel to use updated packages.\n"
     ]
    }
   ],
   "source": [
    "%pip install -q pinecone langchain-pinecone --no-warn-script-location"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "00f59e4c",
   "metadata": {},
   "source": [
    "# 1. knowledge Base 구성을 위한 데이터 생성"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "2338831b",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "193"
      ]
     },
     "execution_count": 12,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "from langchain_community.document_loaders import Docx2txtLoader\n",
    "from langchain_text_splitters import RecursiveCharacterTextSplitter\n",
    "loader = Docx2txtLoader('data/소득세법(법률)(제21065호)(20260102).docx')\n",
    "text_splitter = RecursiveCharacterTextSplitter(\n",
    "    chunk_size=1500, \n",
    "    chunk_overlap=200,\n",
    "    # separators=[\"\\n\\n\", \"\\n\", \" \", \"\"]\n",
    ")\n",
    "document_list = loader.load_and_split(text_splitter=text_splitter)\n",
    "len(document_list)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "6689abb3",
   "metadata": {},
   "outputs": [],
   "source": [
    "# embedding : upstage의 solar-embedding-1-large-passage\n",
    "from dotenv import load_dotenv\n",
    "from langchain_upstage import UpstageEmbeddings\n",
    "load_dotenv()\n",
    "embedding = UpstageEmbeddings(model=\"solar-embedding-1-large-passage\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "id": "3e58f8ef",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "4096"
      ]
     },
     "execution_count": 14,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "len(embedding.embed_query(\"소득세법\"))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "id": "5272d7d5",
   "metadata": {},
   "outputs": [
    {
     "ename": "NotFoundException",
     "evalue": "(404)\nReason: Not Found\nHTTP response headers: HTTPHeaderDict({'content-type': 'text/plain; charset=utf-8', 'access-control-allow-origin': '*', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-expose-headers': '*', 'x-pinecone-api-version': '2025-04', 'x-cloud-trace-context': '984b6cc04f966335fbc20b8d2889e464', 'date': 'Fri, 09 Jan 2026 03:38:21 GMT', 'server': 'Google Frontend', 'Content-Length': '92', 'Via': '1.1 google', 'Alt-Svc': 'h3=\":443\"; ma=2592000,h3-29=\":443\"; ma=2592000'})\nHTTP response body: {\"error\":{\"code\":\"NOT_FOUND\",\"message\":\"Resource tax-index-upstage not found\"},\"status\":404}\n",
     "output_type": "error",
     "traceback": [
      "\u001b[1;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[1;31mNotFoundException\u001b[0m                         Traceback (most recent call last)",
      "File \u001b[1;32m<timed exec>:18\u001b[0m\n",
      "File \u001b[1;32m~\\anaconda3\\envs\\llm\\lib\\site-packages\\langchain_pinecone\\vectorstores.py:262\u001b[0m, in \u001b[0;36mPineconeVectorStore.__init__\u001b[1;34m(self, index, embedding, text_key, namespace, distance_strategy, pinecone_api_key, index_name, host)\u001b[0m\n\u001b[0;32m    257\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m _index_host:\n\u001b[0;32m    258\u001b[0m     client \u001b[38;5;241m=\u001b[39m PineconeClient(\n\u001b[0;32m    259\u001b[0m         api_key\u001b[38;5;241m=\u001b[39m\u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_pinecone_api_key\u001b[38;5;241m.\u001b[39mget_secret_value(),\n\u001b[0;32m    260\u001b[0m         source_tag\u001b[38;5;241m=\u001b[39m\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mlangchain\u001b[39m\u001b[38;5;124m\"\u001b[39m,\n\u001b[0;32m    261\u001b[0m     )\n\u001b[1;32m--> 262\u001b[0m     _index \u001b[38;5;241m=\u001b[39m \u001b[43mclient\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mIndex\u001b[49m\u001b[43m(\u001b[49m\u001b[43mname\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43m_index_name\u001b[49m\u001b[43m)\u001b[49m\n\u001b[0;32m    263\u001b[0m     \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_index \u001b[38;5;241m=\u001b[39m _index\n\u001b[0;32m    264\u001b[0m     \u001b[38;5;66;03m# Cache host from the created index\u001b[39;00m\n",
      "File \u001b[1;32m~\\anaconda3\\envs\\llm\\lib\\site-packages\\pinecone\\pinecone.py:490\u001b[0m, in \u001b[0;36mPinecone.Index\u001b[1;34m(self, name, host, **kwargs)\u001b[0m\n\u001b[0;32m    487\u001b[0m     index_host \u001b[38;5;241m=\u001b[39m normalize_host(host)\n\u001b[0;32m    488\u001b[0m \u001b[38;5;28;01melse\u001b[39;00m:\n\u001b[0;32m    489\u001b[0m     \u001b[38;5;66;03m# Otherwise, get host url from describe_index using the index name\u001b[39;00m\n\u001b[1;32m--> 490\u001b[0m     index_host \u001b[38;5;241m=\u001b[39m \u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mdb\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mindex\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43m_get_host\u001b[49m\u001b[43m(\u001b[49m\u001b[43mname\u001b[49m\u001b[43m)\u001b[49m\n\u001b[0;32m    492\u001b[0m \u001b[38;5;28;01mreturn\u001b[39;00m _Index(\n\u001b[0;32m    493\u001b[0m     host\u001b[38;5;241m=\u001b[39mindex_host,\n\u001b[0;32m    494\u001b[0m     api_key\u001b[38;5;241m=\u001b[39mapi_key,\n\u001b[1;32m   (...)\u001b[0m\n\u001b[0;32m    498\u001b[0m     \u001b[38;5;241m*\u001b[39m\u001b[38;5;241m*\u001b[39mkwargs,\n\u001b[0;32m    499\u001b[0m )\n",
      "File \u001b[1;32m~\\anaconda3\\envs\\llm\\lib\\site-packages\\pinecone\\db_control\\resources\\sync\\index.py:245\u001b[0m, in \u001b[0;36mIndexResource._get_host\u001b[1;34m(self, name)\u001b[0m\n\u001b[0;32m    243\u001b[0m \u001b[38;5;28;01mdef\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;21m_get_host\u001b[39m(\u001b[38;5;28mself\u001b[39m, name: \u001b[38;5;28mstr\u001b[39m) \u001b[38;5;241m-\u001b[39m\u001b[38;5;241m>\u001b[39m \u001b[38;5;28mstr\u001b[39m:\n\u001b[0;32m    244\u001b[0m \u001b[38;5;250m    \u001b[39m\u001b[38;5;124;03m\"\"\":meta private:\"\"\"\u001b[39;00m\n\u001b[1;32m--> 245\u001b[0m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43m_index_host_store\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mget_host\u001b[49m\u001b[43m(\u001b[49m\n\u001b[0;32m    246\u001b[0m \u001b[43m        \u001b[49m\u001b[43mapi\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43m_index_api\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mconfig\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mconfig\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mindex_name\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mname\u001b[49m\n\u001b[0;32m    247\u001b[0m \u001b[43m    \u001b[49m\u001b[43m)\u001b[49m\n",
      "File \u001b[1;32m~\\anaconda3\\envs\\llm\\lib\\site-packages\\pinecone\\db_control\\index_host_store.py:47\u001b[0m, in \u001b[0;36mIndexHostStore.get_host\u001b[1;34m(self, api, config, index_name)\u001b[0m\n\u001b[0;32m     45\u001b[0m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_indexHosts[key]\n\u001b[0;32m     46\u001b[0m \u001b[38;5;28;01melse\u001b[39;00m:\n\u001b[1;32m---> 47\u001b[0m     description \u001b[38;5;241m=\u001b[39m \u001b[43mapi\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mdescribe_index\u001b[49m\u001b[43m(\u001b[49m\u001b[43mindex_name\u001b[49m\u001b[43m)\u001b[49m\n\u001b[0;32m     48\u001b[0m     \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mset_host(config, index_name, description\u001b[38;5;241m.\u001b[39mhost)\n\u001b[0;32m     49\u001b[0m     \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mkey_exists(key):\n",
      "File \u001b[1;32m~\\anaconda3\\envs\\llm\\lib\\site-packages\\pinecone\\openapi_support\\endpoint.py:102\u001b[0m, in \u001b[0;36mEndpoint.__call__\u001b[1;34m(self, *args, **kwargs)\u001b[0m\n\u001b[0;32m     91\u001b[0m \u001b[38;5;28;01mdef\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;21m__call__\u001b[39m(\u001b[38;5;28mself\u001b[39m, \u001b[38;5;241m*\u001b[39margs, \u001b[38;5;241m*\u001b[39m\u001b[38;5;241m*\u001b[39mkwargs):\n\u001b[0;32m     92\u001b[0m \u001b[38;5;250m    \u001b[39m\u001b[38;5;124;03m\"\"\"This method is invoked when endpoints are called\u001b[39;00m\n\u001b[0;32m     93\u001b[0m \u001b[38;5;124;03m    Example:\u001b[39;00m\n\u001b[0;32m     94\u001b[0m \n\u001b[1;32m   (...)\u001b[0m\n\u001b[0;32m    100\u001b[0m \n\u001b[0;32m    101\u001b[0m \u001b[38;5;124;03m    \"\"\"\u001b[39;00m\n\u001b[1;32m--> 102\u001b[0m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mcallable(\u001b[38;5;28mself\u001b[39m, \u001b[38;5;241m*\u001b[39margs, \u001b[38;5;241m*\u001b[39m\u001b[38;5;241m*\u001b[39mkwargs)\n",
      "File \u001b[1;32m~\\anaconda3\\envs\\llm\\lib\\site-packages\\pinecone\\core\\openapi\\db_control\\api\\manage_indexes_api.py:883\u001b[0m, in \u001b[0;36mManageIndexesApi.__init__.<locals>.__describe_index\u001b[1;34m(self, index_name, **kwargs)\u001b[0m\n\u001b[0;32m    881\u001b[0m kwargs \u001b[38;5;241m=\u001b[39m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_process_openapi_kwargs(kwargs)\n\u001b[0;32m    882\u001b[0m kwargs[\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mindex_name\u001b[39m\u001b[38;5;124m\"\u001b[39m] \u001b[38;5;241m=\u001b[39m index_name\n\u001b[1;32m--> 883\u001b[0m \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mcall_with_http_info(\u001b[38;5;241m*\u001b[39m\u001b[38;5;241m*\u001b[39mkwargs)\n",
      "File \u001b[1;32m~\\anaconda3\\envs\\llm\\lib\\site-packages\\pinecone\\openapi_support\\endpoint.py:134\u001b[0m, in \u001b[0;36mEndpoint.call_with_http_info\u001b[1;34m(self, **kwargs)\u001b[0m\n\u001b[0;32m    124\u001b[0m params \u001b[38;5;241m=\u001b[39m EndpointUtils\u001b[38;5;241m.\u001b[39mgather_params(\n\u001b[0;32m    125\u001b[0m     attribute_map\u001b[38;5;241m=\u001b[39m\u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mattribute_map,\n\u001b[0;32m    126\u001b[0m     location_map\u001b[38;5;241m=\u001b[39m\u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mlocation_map,\n\u001b[1;32m   (...)\u001b[0m\n\u001b[0;32m    129\u001b[0m     kwargs\u001b[38;5;241m=\u001b[39mkwargs,\n\u001b[0;32m    130\u001b[0m )\n\u001b[0;32m    132\u001b[0m HeaderUtil\u001b[38;5;241m.\u001b[39mprepare_headers(headers_map\u001b[38;5;241m=\u001b[39m\u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mheaders_map, params\u001b[38;5;241m=\u001b[39mparams)\n\u001b[1;32m--> 134\u001b[0m \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mapi_client\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mcall_api\u001b[49m\u001b[43m(\u001b[49m\n\u001b[0;32m    135\u001b[0m \u001b[43m    \u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43msettings\u001b[49m\u001b[43m[\u001b[49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[38;5;124;43mendpoint_path\u001b[39;49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[43m]\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    136\u001b[0m \u001b[43m    \u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43msettings\u001b[49m\u001b[43m[\u001b[49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[38;5;124;43mhttp_method\u001b[39;49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[43m]\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    137\u001b[0m \u001b[43m    \u001b[49m\u001b[43mpath_params\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mparams\u001b[49m\u001b[43m[\u001b[49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[38;5;124;43mpath\u001b[39;49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[43m]\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    138\u001b[0m \u001b[43m    \u001b[49m\u001b[43mquery_params\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mparams\u001b[49m\u001b[43m[\u001b[49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[38;5;124;43mquery\u001b[39;49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[43m]\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    139\u001b[0m \u001b[43m    \u001b[49m\u001b[43mheader_params\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mparams\u001b[49m\u001b[43m[\u001b[49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[38;5;124;43mheader\u001b[39;49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[43m]\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    140\u001b[0m \u001b[43m    \u001b[49m\u001b[43mbody\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mparams\u001b[49m\u001b[43m[\u001b[49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[38;5;124;43mbody\u001b[39;49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[43m]\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    141\u001b[0m \u001b[43m    \u001b[49m\u001b[43mpost_params\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mparams\u001b[49m\u001b[43m[\u001b[49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[38;5;124;43mform\u001b[39;49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[43m]\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    142\u001b[0m \u001b[43m    \u001b[49m\u001b[43mfiles\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mparams\u001b[49m\u001b[43m[\u001b[49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[38;5;124;43mfile\u001b[39;49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[43m]\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    143\u001b[0m \u001b[43m    \u001b[49m\u001b[43mresponse_type\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43msettings\u001b[49m\u001b[43m[\u001b[49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[38;5;124;43mresponse_type\u001b[39;49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[43m]\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    144\u001b[0m \u001b[43m    \u001b[49m\u001b[43mauth_settings\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43msettings\u001b[49m\u001b[43m[\u001b[49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[38;5;124;43mauth\u001b[39;49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[43m]\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    145\u001b[0m \u001b[43m    \u001b[49m\u001b[43masync_req\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mkwargs\u001b[49m\u001b[43m[\u001b[49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[38;5;124;43masync_req\u001b[39;49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[43m]\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    146\u001b[0m \u001b[43m    \u001b[49m\u001b[43masync_threadpool_executor\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mkwargs\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mget\u001b[49m\u001b[43m(\u001b[49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[38;5;124;43masync_threadpool_executor\u001b[39;49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;28;43;01mNone\u001b[39;49;00m\u001b[43m)\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    147\u001b[0m \u001b[43m    \u001b[49m\u001b[43m_check_type\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mkwargs\u001b[49m\u001b[43m[\u001b[49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[38;5;124;43m_check_return_type\u001b[39;49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[43m]\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    148\u001b[0m \u001b[43m    \u001b[49m\u001b[43m_return_http_data_only\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mkwargs\u001b[49m\u001b[43m[\u001b[49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[38;5;124;43m_return_http_data_only\u001b[39;49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[43m]\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    149\u001b[0m \u001b[43m    \u001b[49m\u001b[43m_preload_content\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mkwargs\u001b[49m\u001b[43m[\u001b[49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[38;5;124;43m_preload_content\u001b[39;49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[43m]\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    150\u001b[0m \u001b[43m    \u001b[49m\u001b[43m_request_timeout\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mkwargs\u001b[49m\u001b[43m[\u001b[49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[38;5;124;43m_request_timeout\u001b[39;49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[43m]\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    151\u001b[0m \u001b[43m    \u001b[49m\u001b[43m_host\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43m_host\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    152\u001b[0m \u001b[43m    \u001b[49m\u001b[43mcollection_formats\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mparams\u001b[49m\u001b[43m[\u001b[49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[38;5;124;43mcollection_format\u001b[39;49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[43m]\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    153\u001b[0m \u001b[43m\u001b[49m\u001b[43m)\u001b[49m\n",
      "File \u001b[1;32m~\\anaconda3\\envs\\llm\\lib\\site-packages\\pinecone\\openapi_support\\api_client.py:306\u001b[0m, in \u001b[0;36mApiClient.call_api\u001b[1;34m(self, resource_path, method, path_params, query_params, header_params, body, post_params, files, response_type, auth_settings, async_req, async_threadpool_executor, _return_http_data_only, collection_formats, _preload_content, _request_timeout, _host, _check_type)\u001b[0m\n\u001b[0;32m    285\u001b[0m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mthreadpool_executor\u001b[38;5;241m.\u001b[39msubmit(\n\u001b[0;32m    286\u001b[0m         \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m__call_api,\n\u001b[0;32m    287\u001b[0m         resource_path,\n\u001b[1;32m   (...)\u001b[0m\n\u001b[0;32m    302\u001b[0m         _check_type,\n\u001b[0;32m    303\u001b[0m     )\n\u001b[0;32m    305\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m async_req:\n\u001b[1;32m--> 306\u001b[0m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43m__call_api\u001b[49m\u001b[43m(\u001b[49m\n\u001b[0;32m    307\u001b[0m \u001b[43m        \u001b[49m\u001b[43mresource_path\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    308\u001b[0m \u001b[43m        \u001b[49m\u001b[43mmethod\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    309\u001b[0m \u001b[43m        \u001b[49m\u001b[43mpath_params\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    310\u001b[0m \u001b[43m        \u001b[49m\u001b[43mquery_params\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    311\u001b[0m \u001b[43m        \u001b[49m\u001b[43mheader_params\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    312\u001b[0m \u001b[43m        \u001b[49m\u001b[43mbody\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    313\u001b[0m \u001b[43m        \u001b[49m\u001b[43mpost_params\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    314\u001b[0m \u001b[43m        \u001b[49m\u001b[43mfiles\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    315\u001b[0m \u001b[43m        \u001b[49m\u001b[43mresponse_type\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    316\u001b[0m \u001b[43m        \u001b[49m\u001b[43mauth_settings\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    317\u001b[0m \u001b[43m        \u001b[49m\u001b[43m_return_http_data_only\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    318\u001b[0m \u001b[43m        \u001b[49m\u001b[43mcollection_formats\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    319\u001b[0m \u001b[43m        \u001b[49m\u001b[43m_preload_content\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    320\u001b[0m \u001b[43m        \u001b[49m\u001b[43m_request_timeout\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    321\u001b[0m \u001b[43m        \u001b[49m\u001b[43m_host\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    322\u001b[0m \u001b[43m        \u001b[49m\u001b[43m_check_type\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    323\u001b[0m \u001b[43m    \u001b[49m\u001b[43m)\u001b[49m\n\u001b[0;32m    325\u001b[0m \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mpool\u001b[38;5;241m.\u001b[39mapply_async(\n\u001b[0;32m    326\u001b[0m     \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m__call_api,\n\u001b[0;32m    327\u001b[0m     (\n\u001b[1;32m   (...)\u001b[0m\n\u001b[0;32m    344\u001b[0m     ),\n\u001b[0;32m    345\u001b[0m )\n",
      "File \u001b[1;32m~\\anaconda3\\envs\\llm\\lib\\site-packages\\pinecone\\openapi_support\\api_client.py:182\u001b[0m, in \u001b[0;36mApiClient.__call_api\u001b[1;34m(self, resource_path, method, path_params, query_params, header_params, body, post_params, files, response_type, auth_settings, _return_http_data_only, collection_formats, _preload_content, _request_timeout, _host, _check_type)\u001b[0m\n\u001b[0;32m    180\u001b[0m \u001b[38;5;28;01mexcept\u001b[39;00m PineconeApiException \u001b[38;5;28;01mas\u001b[39;00m e:\n\u001b[0;32m    181\u001b[0m     e\u001b[38;5;241m.\u001b[39mbody \u001b[38;5;241m=\u001b[39m e\u001b[38;5;241m.\u001b[39mbody\u001b[38;5;241m.\u001b[39mdecode(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mutf-8\u001b[39m\u001b[38;5;124m\"\u001b[39m)\n\u001b[1;32m--> 182\u001b[0m     \u001b[38;5;28;01mraise\u001b[39;00m e\n\u001b[0;32m    184\u001b[0m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mlast_response \u001b[38;5;241m=\u001b[39m response_data\n\u001b[0;32m    186\u001b[0m return_data \u001b[38;5;241m=\u001b[39m response_data\n",
      "File \u001b[1;32m~\\anaconda3\\envs\\llm\\lib\\site-packages\\pinecone\\openapi_support\\api_client.py:170\u001b[0m, in \u001b[0;36mApiClient.__call_api\u001b[1;34m(self, resource_path, method, path_params, query_params, header_params, body, post_params, files, response_type, auth_settings, _return_http_data_only, collection_formats, _preload_content, _request_timeout, _host, _check_type)\u001b[0m\n\u001b[0;32m    161\u001b[0m url \u001b[38;5;241m=\u001b[39m build_request_url(\n\u001b[0;32m    162\u001b[0m     config\u001b[38;5;241m=\u001b[39mconfig,\n\u001b[0;32m    163\u001b[0m     processed_path_params\u001b[38;5;241m=\u001b[39mpath_params_tuple,\n\u001b[0;32m    164\u001b[0m     resource_path\u001b[38;5;241m=\u001b[39mresource_path,\n\u001b[0;32m    165\u001b[0m     _host\u001b[38;5;241m=\u001b[39m_host,\n\u001b[0;32m    166\u001b[0m )\n\u001b[0;32m    168\u001b[0m \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[0;32m    169\u001b[0m     \u001b[38;5;66;03m# perform request and return response\u001b[39;00m\n\u001b[1;32m--> 170\u001b[0m     response_data \u001b[38;5;241m=\u001b[39m \u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mrequest\u001b[49m\u001b[43m(\u001b[49m\n\u001b[0;32m    171\u001b[0m \u001b[43m        \u001b[49m\u001b[43mmethod\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    172\u001b[0m \u001b[43m        \u001b[49m\u001b[43murl\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    173\u001b[0m \u001b[43m        \u001b[49m\u001b[43mquery_params\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mprocessed_query_params\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    174\u001b[0m \u001b[43m        \u001b[49m\u001b[43mheaders\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mheaders_tuple\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    175\u001b[0m \u001b[43m        \u001b[49m\u001b[43mpost_params\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mprocessed_post_params\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    176\u001b[0m \u001b[43m        \u001b[49m\u001b[43mbody\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mbody\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    177\u001b[0m \u001b[43m        \u001b[49m\u001b[43m_preload_content\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43m_preload_content\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    178\u001b[0m \u001b[43m        \u001b[49m\u001b[43m_request_timeout\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43m_request_timeout\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    179\u001b[0m \u001b[43m    \u001b[49m\u001b[43m)\u001b[49m\n\u001b[0;32m    180\u001b[0m \u001b[38;5;28;01mexcept\u001b[39;00m PineconeApiException \u001b[38;5;28;01mas\u001b[39;00m e:\n\u001b[0;32m    181\u001b[0m     e\u001b[38;5;241m.\u001b[39mbody \u001b[38;5;241m=\u001b[39m e\u001b[38;5;241m.\u001b[39mbody\u001b[38;5;241m.\u001b[39mdecode(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mutf-8\u001b[39m\u001b[38;5;124m\"\u001b[39m)\n",
      "File \u001b[1;32m~\\anaconda3\\envs\\llm\\lib\\site-packages\\pinecone\\openapi_support\\api_client.py:360\u001b[0m, in \u001b[0;36mApiClient.request\u001b[1;34m(self, method, url, query_params, headers, post_params, body, _preload_content, _request_timeout)\u001b[0m\n\u001b[0;32m    358\u001b[0m \u001b[38;5;250m\u001b[39m\u001b[38;5;124;03m\"\"\"Makes the HTTP request using RESTClient.\"\"\"\u001b[39;00m\n\u001b[0;32m    359\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m method \u001b[38;5;241m==\u001b[39m \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mGET\u001b[39m\u001b[38;5;124m\"\u001b[39m:\n\u001b[1;32m--> 360\u001b[0m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mrest_client\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mGET\u001b[49m\u001b[43m(\u001b[49m\n\u001b[0;32m    361\u001b[0m \u001b[43m        \u001b[49m\u001b[43murl\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    362\u001b[0m \u001b[43m        \u001b[49m\u001b[43mquery_params\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mquery_params\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    363\u001b[0m \u001b[43m        \u001b[49m\u001b[43m_preload_content\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43m_preload_content\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    364\u001b[0m \u001b[43m        \u001b[49m\u001b[43m_request_timeout\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43m_request_timeout\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    365\u001b[0m \u001b[43m        \u001b[49m\u001b[43mheaders\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mheaders\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m    366\u001b[0m \u001b[43m    \u001b[49m\u001b[43m)\u001b[49m\n\u001b[0;32m    367\u001b[0m \u001b[38;5;28;01melif\u001b[39;00m method \u001b[38;5;241m==\u001b[39m \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mHEAD\u001b[39m\u001b[38;5;124m\"\u001b[39m:\n\u001b[0;32m    368\u001b[0m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mrest_client\u001b[38;5;241m.\u001b[39mHEAD(\n\u001b[0;32m    369\u001b[0m         url,\n\u001b[0;32m    370\u001b[0m         query_params\u001b[38;5;241m=\u001b[39mquery_params,\n\u001b[1;32m   (...)\u001b[0m\n\u001b[0;32m    373\u001b[0m         headers\u001b[38;5;241m=\u001b[39mheaders,\n\u001b[0;32m    374\u001b[0m     )\n",
      "File \u001b[1;32m~\\anaconda3\\envs\\llm\\lib\\site-packages\\pinecone\\openapi_support\\rest_utils.py:75\u001b[0m, in \u001b[0;36mRestClientInterface.GET\u001b[1;34m(self, url, headers, query_params, _preload_content, _request_timeout)\u001b[0m\n\u001b[0;32m     72\u001b[0m \u001b[38;5;28;01mdef\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;21mGET\u001b[39m(\n\u001b[0;32m     73\u001b[0m     \u001b[38;5;28mself\u001b[39m, url, headers\u001b[38;5;241m=\u001b[39m\u001b[38;5;28;01mNone\u001b[39;00m, query_params\u001b[38;5;241m=\u001b[39m\u001b[38;5;28;01mNone\u001b[39;00m, _preload_content\u001b[38;5;241m=\u001b[39m\u001b[38;5;28;01mTrue\u001b[39;00m, _request_timeout\u001b[38;5;241m=\u001b[39m\u001b[38;5;28;01mNone\u001b[39;00m\n\u001b[0;32m     74\u001b[0m ):\n\u001b[1;32m---> 75\u001b[0m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mrequest\u001b[49m\u001b[43m(\u001b[49m\n\u001b[0;32m     76\u001b[0m \u001b[43m        \u001b[49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[38;5;124;43mGET\u001b[39;49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[43m,\u001b[49m\n\u001b[0;32m     77\u001b[0m \u001b[43m        \u001b[49m\u001b[43murl\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m     78\u001b[0m \u001b[43m        \u001b[49m\u001b[43mheaders\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mheaders\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m     79\u001b[0m \u001b[43m        \u001b[49m\u001b[43m_preload_content\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43m_preload_content\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m     80\u001b[0m \u001b[43m        \u001b[49m\u001b[43m_request_timeout\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43m_request_timeout\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m     81\u001b[0m \u001b[43m        \u001b[49m\u001b[43mquery_params\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mquery_params\u001b[49m\u001b[43m,\u001b[49m\n\u001b[0;32m     82\u001b[0m \u001b[43m    \u001b[49m\u001b[43m)\u001b[49m\n",
      "File \u001b[1;32m~\\anaconda3\\envs\\llm\\lib\\site-packages\\pinecone\\openapi_support\\rest_urllib3.py:267\u001b[0m, in \u001b[0;36mUrllib3RestClient.request\u001b[1;34m(self, method, url, query_params, headers, body, post_params, _preload_content, _request_timeout)\u001b[0m\n\u001b[0;32m    264\u001b[0m     \u001b[38;5;66;03m# log response body\u001b[39;00m\n\u001b[0;32m    265\u001b[0m     logger\u001b[38;5;241m.\u001b[39mdebug(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mresponse body: \u001b[39m\u001b[38;5;132;01m%s\u001b[39;00m\u001b[38;5;124m\"\u001b[39m, r\u001b[38;5;241m.\u001b[39mdata)\n\u001b[1;32m--> 267\u001b[0m \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[43mraise_exceptions_or_return\u001b[49m\u001b[43m(\u001b[49m\u001b[43mr\u001b[49m\u001b[43m)\u001b[49m\n",
      "File \u001b[1;32m~\\anaconda3\\envs\\llm\\lib\\site-packages\\pinecone\\openapi_support\\rest_utils.py:44\u001b[0m, in \u001b[0;36mraise_exceptions_or_return\u001b[1;34m(r)\u001b[0m\n\u001b[0;32m     41\u001b[0m     \u001b[38;5;28;01mraise\u001b[39;00m ForbiddenException(http_resp\u001b[38;5;241m=\u001b[39mr)\n\u001b[0;32m     43\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m r\u001b[38;5;241m.\u001b[39mstatus \u001b[38;5;241m==\u001b[39m \u001b[38;5;241m404\u001b[39m:\n\u001b[1;32m---> 44\u001b[0m     \u001b[38;5;28;01mraise\u001b[39;00m NotFoundException(http_resp\u001b[38;5;241m=\u001b[39mr)\n\u001b[0;32m     46\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;241m500\u001b[39m \u001b[38;5;241m<\u001b[39m\u001b[38;5;241m=\u001b[39m r\u001b[38;5;241m.\u001b[39mstatus \u001b[38;5;241m<\u001b[39m\u001b[38;5;241m=\u001b[39m \u001b[38;5;241m599\u001b[39m:\n\u001b[0;32m     47\u001b[0m     \u001b[38;5;28;01mraise\u001b[39;00m ServiceException(http_resp\u001b[38;5;241m=\u001b[39mr)\n",
      "\u001b[1;31mNotFoundException\u001b[0m: (404)\nReason: Not Found\nHTTP response headers: HTTPHeaderDict({'content-type': 'text/plain; charset=utf-8', 'access-control-allow-origin': '*', 'vary': 'origin, access-control-request-method, access-control-request-headers', 'access-control-expose-headers': '*', 'x-pinecone-api-version': '2025-04', 'x-cloud-trace-context': '984b6cc04f966335fbc20b8d2889e464', 'date': 'Fri, 09 Jan 2026 03:38:21 GMT', 'server': 'Google Frontend', 'Content-Length': '92', 'Via': '1.1 google', 'Alt-Svc': 'h3=\":443\"; ma=2592000,h3-29=\":443\"; ma=2592000'})\nHTTP response body: {\"error\":{\"code\":\"NOT_FOUND\",\"message\":\"Resource tax-index-upstage not found\"},\"status\":404}\n"
     ]
    }
   ],
   "source": [
    "%%time\n",
    "# pinecone vector database\n",
    "from pinecone import Pinecone\n",
    "from langchain_pinecone import PineconeVectorStore\n",
    "import os\n",
    "pc = Pinecone(\n",
    "    api_key=os.getenv(\"PINECONE_API_KEY\")\n",
    ")\n",
    "# 데이터를 처음 업로드할 때\n",
    "index_name = \"tax-index-upstage\"\n",
    "# database = PineconeVectorStore.from_documents(\n",
    "#     documents=document_list,\n",
    "#     embedding=embedding,\n",
    "#     index_name=index_name\n",
    "# )\n",
    "# 업로드시 경고가 안보이려면 아나콘다 프롬프트 llm환경에서 conda install -c conda-forge ipywidgets\n",
    "\n",
    "# 업로드한 벡터db를 가져올 때\n",
    "database = PineconeVectorStore(\n",
    "    embedding=embedding,# 질문을 임베딩하여 유사도 검색\n",
    "    index_name=index_name\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "af1f8331",
   "metadata": {},
   "source": [
    "# 2. 답변 생성을 위한 Retrieval"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "id": "d9254811",
   "metadata": {},
   "outputs": [
    {
     "ename": "NameError",
     "evalue": "name 'database' is not defined",
     "output_type": "error",
     "traceback": [
      "\u001b[1;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[1;31mNameError\u001b[0m                                 Traceback (most recent call last)",
      "Cell \u001b[1;32mIn[16], line 2\u001b[0m\n\u001b[0;32m      1\u001b[0m query \u001b[38;5;241m=\u001b[39m \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124m연봉이 5천만원인 직장인의 소득세는 얼마인가요?\u001b[39m\u001b[38;5;124m\"\u001b[39m\n\u001b[1;32m----> 2\u001b[0m retrieved_docs \u001b[38;5;241m=\u001b[39m \u001b[43mdatabase\u001b[49m\u001b[38;5;241m.\u001b[39msimilarity_search(query, k\u001b[38;5;241m=\u001b[39m\u001b[38;5;241m3\u001b[39m) \u001b[38;5;66;03m# 기본k값:4\u001b[39;00m\n",
      "\u001b[1;31mNameError\u001b[0m: name 'database' is not defined"
     ]
    }
   ],
   "source": [
    "query = \"연봉이 5천만원인 직장인의 소득세는 얼마인가요?\"\n",
    "retrieved_docs = database.similarity_search(query, k=3) # 기본k값:4"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "bf5502d5",
   "metadata": {},
   "outputs": [],
   "source": [
    "# retrieved_docs[2].page_content\n",
    "retrieved_doc = \"\\n\\n---\\n\\n\".join([doc.page_content for doc in retrieved_docs])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "dbebb2ce",
   "metadata": {},
   "outputs": [],
   "source": [
    "retriever = database.as_retriever(\n",
    "    search_kwargs={\"k\":3}\n",
    ")\n",
    "retrived_docs = retriever.invoke(query)\n",
    "retrieved_doc = \"\\n\\n---\\n\\n\".join([doc.page_content for doc in retrieved_docs])"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "c4d73026",
   "metadata": {},
   "source": [
    "# 3. 답변 생성"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "0020f4ad",
   "metadata": {},
   "outputs": [],
   "source": [
    "from langchain_openai import ChatOpenAI\n",
    "llm = ChatOpenAI(model = \"gpt-4.1-nano\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "ad37a999",
   "metadata": {},
   "outputs": [],
   "source": [
    "# upstage에서 받은 20$로 llm을 사용하고 싶다면\n",
    "from langchain_upstage import ChatUpstage\n",
    "llm = ChatUpstage(\n",
    "    model = \"solar-pro2\",\n",
    "    reasoning_effort=\"high\" #느리지만 더 깊게 추론함 (low, medium)\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "95f2d7fc",
   "metadata": {},
   "outputs": [],
   "source": [
    "prompt = f\"\"\"[identity]\n",
    "- 당신은 최고의 한국 소득세법 전문가입니다\n",
    "- [context]를 참고해서 사용자의 질문에 답변해 주세요.\n",
    "- [context]는 다음과 같아요\n",
    "{retrieved_doc}\n",
    "- 질문 : {query}\"\"\""
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "aa5a57b3",
   "metadata": {},
   "outputs": [],
   "source": [
    "ai_message = llm.invoke(prompt)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "38554977",
   "metadata": {},
   "outputs": [],
   "source": [
    "print(ai_message.content)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "09c44823",
   "metadata": {},
   "source": [
    "# 4. langchain 답변 생성\n",
    "- ch9.07_LangChain과 vectorDatabase을 활용한 RAG구현(UpstageEmbedding) 참조"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "eac3838b",
   "metadata": {},
   "outputs": [],
   "source": [
    "from langchain_openai import ChatOpenAI, OpenAIEmbeddings\n",
    "from langchain_chroma import Chroma\n",
    "from langchain_core.prompts import ChatPromptTemplate\n",
    "from langchain_core.output_parsers import StrOutputParser\n",
    "from langchain_core.runnables import RunnablePassthrough\n",
    "from dotenv import load_dotenv\n",
    "\n",
    "# 1. LLM과 임베딩 초기화\n",
    "load_dotenv()\n",
    "# llm = ChatOpenAI(model = \"gpt-4.1-mini\")\n",
    "from langchain_upstage import ChatUpstage\n",
    "llm = ChatUpstage(model=\"solar-pro2\")\n",
    "\n",
    "embedding = UpstageEmbeddings(model=\"solar-embedding-1-large-passage\")\n",
    "\n",
    "# 2. # 업로드한 벡터db를 가져올 때\n",
    "vectorstore = PineconeVectorStore(\n",
    "    embedding=embedding,# 질문을 임베딩하여 유사도 검색\n",
    "    index_name=index_name\n",
    ")\n",
    "# 3. Retriever 생성\n",
    "retriever = vectorstore.as_retriever(search_type=\"similarity\", search_kwargs={\"k\":4})\n",
    "# 4. 프롬프트 템플릿\n",
    "template = f\"\"\"당신은 최고의 한국 소득세 전문가입니다.\n",
    "다음 문맥을 참고하여 질문에 답하세요.\n",
    "답을 모르면 모른다고 답하세요.\n",
    "최대 3문장으로 간결하게 답변하세요.\n",
    "질문 : {{query}}\n",
    "문맥 : {{context}}\n",
    "답변 : \"\"\"\n",
    "prompt = ChatPromptTemplate.from_template(template)\n",
    "# 5. 검색된 document를 텍스트로 변환하는 함수\n",
    "def format_documents(documents):\n",
    "    return  \"\\n\\n---\\n\\n\".join([doc.page_content for doc in documents])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "9eae209e",
   "metadata": {},
   "outputs": [],
   "source": [
    "# 6. RAG 체인 구성 (LCEL 방식)\n",
    "from langchain_core.runnables import RunnablePassthrough # {\"query\":\"~\"} => \"~\"\n",
    "rag_chain = (\n",
    "    {\n",
    "        \"context\":retriever | format_documents,\n",
    "        \"query\":RunnablePassthrough() # 질문 그대로 전달\n",
    "    }\n",
    "    | prompt # prompt에 context와 query 변수 주입\n",
    "    | llm    \n",
    "    | StrOutputParser()\n",
    ")\n",
    "# 7. 실행\n",
    "query = \"연봉 5천만원인 직장인의 소득세는 얼마인가요?\"\n",
    "rag_chain.invoke(query)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "68fe8818",
   "metadata": {},
   "source": [
    "# 5. 성능"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "573de917",
   "metadata": {},
   "outputs": [],
   "source": [
    "# 업로드한 벡터 db를 가져오기\n",
    "from dotenv import load_dotenv\n",
    "from pinecone import Pinecone\n",
    "from langchain_upstage import UpstageEmbeddings\n",
    "from langchain_pinecone import PineconeVectorStore\n",
    "import os\n",
    "load_dotenv()\n",
    "pc = Pinecone(\n",
    "    #api_key=os.getenv('PINECONE_API_KEY')\n",
    ")\n",
    "embedding = UpstageEmbeddings(model=\"solar-embedding-1-large-passage\")\n",
    "\n",
    "vectorstore = PineconeVectorStore(\n",
    "    embedding=embedding,\n",
    "    index_name=\"tax-index-upstage\"\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "15a2f967",
   "metadata": {},
   "outputs": [],
   "source": [
    "retriever = vectorstore.as_retriever(\n",
    "    # search_type=\"similarity\", \"mmr\", ...\n",
    "    # search_kwargs = {\"k\":4}\n",
    ")\n",
    "retrieved_docs = retriever.invoke(\"연봉 5천만원인 직장인의 소득세는 얼마인가요?\")\n",
    "for doc in retrieved_docs:\n",
    "    print(doc.page_content)\n",
    "    print(\"-----------------------\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "068d78ba",
   "metadata": {},
   "outputs": [],
   "source": [
    "query = \"연봉이 5천만원인 직장인의 소득세는 얼마인가요?\"\n",
    "retrieved_docs = vectorstore.similarity_search(query, k=3)\n",
    "for doc in retrieved_docs:\n",
    "    print(doc)\n",
    "    print(\"--------------------------\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "65408db3",
   "metadata": {},
   "outputs": [],
   "source": [
    "# query에 가장 유사도가 높은 55조는 이미지로 되어 있어 chunk에 미포함\n",
    "# => 이미지를 table로 변경 (ch9.10예제)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "81e92eec",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "a30ab442",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "0844f6e2",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "519b0d77",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "cd3a9aa7",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "llm(ipykernel)",
   "language": "python",
   "name": "llm"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.19"
  },
  "toc": {
   "base_numbering": 1,
   "nav_menu": {},
   "number_sections": false,
   "sideBar": true,
   "skip_h1_title": false,
   "title_cell": "Table of Contents",
   "title_sidebar": "Contents",
   "toc_cell": false,
   "toc_position": {
    "height": "calc(100% - 180px)",
    "left": "10px",
    "top": "150px",
    "width": "165px"
   },
   "toc_section_display": true,
   "toc_window_display": true
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
